(window.webpackJsonp=window.webpackJsonp||[]).push([[373],{11720:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var s=n(0),i=n.n(s),o=n(21),a=n.n(o),r=n(2965),c=n(2966),l=n(7),h=n(2096),d=n(19),m=n(15);class u extends i.a.Component{constructor(e){super(e),this.state={height:0,width:0},this.innerRef=i.a.createRef(),this.outerRef=i.a.createRef(),this.isFullscreen=!1,this.onResize=()=>this.onResize_(),this.onDataReceived=e=>this.terminal&&this.terminal.write(e),this.terminal=new r.Terminal(Object.assign({},this.props.options)),this.fitAddon=new c.FitAddon,this.fullscreenAddon=new m.sc,this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(this.fullscreenAddon),this.terminal.onData(this.props.onData)}reset(){const e=this.terminal;e&&(e.reset(),e.clear(),e.setOption("disableStdin",!1))}focus(){this.terminal&&this.terminal.focus()}enableiOSFix(){document.getElementsByClassName("pf-v5-c-page__main")[0].classList.add("default-overflow"),document.getElementById("content-scrollable").classList.add("default-overflow")}disableiOSFix(){document.getElementsByClassName("pf-v5-c-page__main")[0].classList.remove("default-overflow"),document.getElementById("content-scrollable").classList.remove("default-overflow")}setFullscreen(e){this.fullscreenAddon.toggleFullScreen(e),this.isFullscreen=e,this.focus(),this.onResize(),e?this.enableiOSFix():this.disableiOSFix()}onConnectionClosed(e){const t=this.terminal;t&&(this.setFullscreen(!1),t.write(`[31m${e||"disconnected"}[m\r\n`),t.cursorHidden=!0,t.setOption("disableStdin",!0),t.refresh(0,t.rows-1))}componentDidMount(){this.terminal.open(this.innerRef.current),this.focus(),this.onResize(),window.addEventListener("resize",this.onResize)}componentWillUnmount(){this.terminal&&this.terminal.dispose(),window.removeEventListener("resize",this.onResize)}onResize_(){const e=this.outerRef.current;if(!e)return;const t=document.getElementsByClassName("pf-v5-c-page")[0].getBoundingClientRect(),n=document.body.getBoundingClientRect(),s=e.getBoundingClientRect(),{padding:i}=this.props,o=Math.floor(t.bottom-(this.isFullscreen?0:s.top)-i),a=Math.floor(n.width-(this.isFullscreen?0:s.left)-(this.isFullscreen?10:i));o===this.state.height&&a===this.state.width||this.setState({height:o,width:a},()=>{var e,t;const n=this.terminal;n&&(this.fitAddon.fit(),this.props.onResize(n.rows,n.cols),null===(t=null===(e=n._core)||void 0===e?void 0:e._syncTextArea)||void 0===t||t.call(e))})}render(){const{t:e}=this.props;return i.a.createElement("div",{ref:this.outerRef,style:this.state,className:this.props.className},i.a.createElement("div",{ref:this.innerRef,className:"co-terminal"},this.isFullscreen&&i.a.createElement(d.a,{className:"co-terminal-collapse-link",onClick:()=>this.setFullscreen(!1),variant:"link"},i.a.createElement(h.a,{className:"co-icon-space-r"}),e("public~Collapse"))))}}const p=Object(l.withTranslation)("translation",{withRef:!0})(u);p.propTypes={onData:a.a.func.isRequired,onResize:a.a.func.isRequired,padding:a.a.number,options:a.a.object},p.defaultProps={padding:30,options:{fontFamily:"monospace",fontSize:16,cursorBlink:!1,cols:80,rows:25}}},5493:function(e,t,n){"use strict";n.r(t),n.d(t,"PodExec",(function(){return y}));var s=n(0),i=n(2050),o=n(16),a=n(107),r=n(320),c=n(7),l=n(4448),h=n(1923),d=n(19),m=n(80),u=n(13),p=n(253),f=n(5),v=n(243),b=n(15),g=n(11720),w=n(1e3),C=n(8),R=n(10),E=n(252);const _=Object(v.a)(b.O.OPENSHIFT)(class extends s.PureComponent{constructor(e){var t,n,i;super(e),this.state={open:!1,containers:{},activeContainer:e.initialContainer||(null===(n=null===(t=e.obj.metadata)||void 0===t?void 0:t.annotations)||void 0===n?void 0:n["kubectl.kubernetes.io/default-container"])||(null===(i=e.obj)||void 0===i?void 0:i.spec.containers[0].name)},this.terminal=s.createRef(),this.onResize=(e,t)=>this.onResize_(e,t),this.onData=e=>this.onData_(e),this.onChangeContainer=e=>this.onChangeContainer_(e)}connect_(){const{metadata:{name:e,namespace:t}}=this.props.obj,{activeContainer:n}=this.state,s=this.props.flags[b.O.OPENSHIFT]?"oc":"kubectl",i=Object(E.e)(this.props.obj)?["cmd"]:["sh","-i","-c","TERM=xterm sh"],o={ns:t,name:e,path:"exec",queryParams:{stdout:1,stdin:1,stderr:1,tty:1,container:n,command:i.map(e=>encodeURIComponent(e)).join("&command=")}};if(this.ws){this.ws.destroy();const{current:e}=this.terminal;e&&e.onConnectionClosed("connecting to "+n)}const a=((Object(u.I)(p.b.getState())||{}).subprotocols||[]).concat("base64.channel.k8s.io");let c;this.ws=new w.a(e+"-terminal",{host:"auto",reconnect:!0,path:Object(C.Jb)(R.PodModel,o),jsonParse:!1,subprotocols:a}).onmessage(n=>{const{current:i}=this.terminal;if("3"===n[0]&&c.includes('starting container process caused "exec: \\"sh\\": executable file not found in $PATH"'))return i.reset(),i.onConnectionClosed(`This container doesn't have a /bin/sh shell. Try specifying your command in a terminal with:\r\n\r\n ${s} -n ${t} exec ${e} -ti <command>`),this.ws.destroy(),void(c="");const o=r.Base64.decode(n.slice(1));i&&i.onDataReceived(o),c=o}).onopen(()=>{const{current:e}=this.terminal;e&&e.reset(),c="",this.setState({open:!0,error:null})}).onclose(e=>{if(!e||!0===e.wasClean)return;const t=e.reason||"The terminal connection has closed.",n=e.reason||this.props.t("public~The terminal connection has closed.");this.setState({error:n}),this.terminal.current&&this.terminal.current.onConnectionClosed(t),this.ws.destroy()}).onerror(e=>console.error("WS error?! "+e))}componentDidMount(){this.connect_()}componentWillUnmount(){this.ws&&"exit\r".split("").map(e=>this.ws.send("0"+r.Base64.encode(e))),this.ws&&this.ws.destroy(),delete this.ws}static getDerivedStateFromProps(e,t){const n=i.a(o.a(e.obj,"spec.containers",[]),"name");return a.a(n,t.containers)?null:{containers:n}}onChangeContainer_(e){var t,n;const s=null===(n=null===(t=this.state.containers)||void 0===t?void 0:t[e])||void 0===n?void 0:n.name;s?s!==this.state.activeContainer&&this.setState({activeContainer:s},()=>{this.connect_(),this.terminal.current&&this.terminal.current.focus()}):console.warn("no name, how did that happen? "+e)}onResize_(e,t){const n=r.Base64.encode(JSON.stringify({Height:e,Width:t}));this.ws&&this.ws.send("4"+n)}setFullscreen(e){this.terminal.current.setFullscreen(e)}onData_(e){this.ws&&this.ws.send("0"+r.Base64.encode(e))}render(){const{containers:e,activeContainer:t,open:n,error:i}=this.state,{message:o,infoMessage:a,t:r,obj:c}=this.props;let u=s.createElement(f.S,null);i?u=s.createElement(g.a,{onResize:()=>{},onData:()=>{},ref:this.terminal}):n&&(u=s.createElement(g.a,{onResize:this.onResize,onData:this.onData,ref:this.terminal}));const p="Running"===c.status.phase?s.createElement(h.a,{onClick:()=>this.connect_()},r("public~Reconnect")):null;return s.createElement("div",null,a,s.createElement("div",{className:"co-toolbar"},s.createElement("div",{className:"co-toolbar__group co-toolbar__group--left"},s.createElement("div",{className:"co-toolbar__item"},r("public~Connecting to")),s.createElement("div",{className:"co-toolbar__item"},Object.keys(e).length>1?s.createElement(f.j,{currentKey:t,containers:this.state.containers,onChange:this.onChangeContainer}):s.createElement(f.i,{name:t}))),!i&&s.createElement("div",{className:"co-toolbar__group co-toolbar__group--right"},s.createElement("div",{className:"co-toolbar__item"},s.createElement(d.a,{variant:"link",className:"pf-m-link--align-right",onClick:()=>this.setFullscreen(!0)},s.createElement(l.a,{className:"co-icon-space-r"}),r("public~Expand"))))),i&&s.createElement(m.a,{variant:"warning",title:i,actionLinks:p,isInline:!0}),o,u)}}),y=Object(c.withTranslation)()(_)}}]);
//# sourceMappingURL=373-chunk-17cfddeaf7d71a42d46a.min.js.map