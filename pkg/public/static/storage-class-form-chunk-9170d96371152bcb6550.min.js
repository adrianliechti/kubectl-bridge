(window.webpackJsonp=window.webpackJsonp||[]).push([[284],{5538:function(e,a,t){"use strict";t.r(a),t.d(a,"ConnectedStorageClassForm",(function(){return q})),t.d(a,"StorageClassForm",(function(){return T}));var r=t(0),l=t(31),n=t(14),s=t(18),o=t(230),i=t(640),c=t(57),m=t(313),u=t(16),d=t(333),p=t(160),v=t(400),b=t(22),g=t(107),h=t(4439),E=t(1122),f=t(547),y=t(2336),C=t(1451),N=t(2324),k=t(1557),w=t(50),S=t(2338),x=t(966),F=t(19),O=t(7),j=t(15),V=t(13),D=t(5),M=t(8),P=t(791),I=t(10);const R=e=>r.createElement(D.c,Object.assign({loader:()=>Promise.resolve().then(t.bind(null,1949)).then(e=>e.NameValueEditor)},e)),_=e=>{var a,t;const{t:l}=Object(O.useTranslation)(),P=Object(n.useNavigate)(),[_,q]=r.useState({name:"",description:"",type:null,parameters:{},reclaim:null,volumeBindingMode:"WaitForFirstConsumer",expansion:!0}),[T,K]=r.useState([["",""]]),[L,W]=r.useState(!1),[U,B]=r.useState(!1),[A,H]=r.useState(null),[J,z]=r.useState({parameters:{}}),[Y,Z]=r.useState(!1),$=r.useRef(),G=r.useRef(""),Q={title:"",provisioner:"",parameters:{},allowVolumeExpansion:()=>!0},X=r.useRef({}),ee=r.useRef({}),ae=r.useRef({}),te=e=>{e.forEach(e=>{e.properties.hasOwnProperty(V.t.CSI)?ee.current[e.properties.CSI.provisioner]=Object.assign({},e.properties.CSI):ae.current[e.properties.OTHERS.provisioner]=Object.assign({},e.properties.OTHERS)})},re={Retain:l("public~Retain"),Delete:l("public~Delete")},le={Immediate:l("public~Immediate"),WaitForFirstConsumer:l("public~WaitForFirstConsumer")},ne=(e,a=_.parameters)=>{const t=u.a(X.current[_.type],["parameters",e,"required"],null);let r=!1;return t&&(r=d.a(t)?t(a):t),r},se=()=>{H(null),z({});const e={};let a=!0;const t=(()=>{const e=_.name,a=e!==G.current,t={error:null,nameIsValid:!0};return a&&(0===e.trim().length?(t.error=l("public~Storage name is required"),t.nameIsValid=!1):$.current&&c.a($.current.data,(function(a){a.metadata.name===e.toLowerCase()&&(t.error=l("public~Storage name must be unique"),t.nameIsValid=!1)})),G.current=e),t})();t.nameIsValid||(e.nameValidationMsg=t.error,a=!1),null===_.type?a=!1:(()=>{const e=_.parameters;return!m.a(e,({validationMsg:e})=>null!==e)})()||(a=!1),(()=>{var e;if(0===_.name.trim().length)return!1;const{type:a,parameters:t}=_;if(null===a)return!1;const r=null===(e=X.current[a])||void 0===e?void 0:e.parameters,l=p.a(r).filter(e=>ne(e));return v.a(l,e=>{const a=u.a(t,[e,"value"]);return!b.a(a)})})()||(a=!1),z(e),W(a)},oe=r.useRef(e);r.useEffect(()=>{var a,t,r,l,n,s,o,c,m,u;const[d,p]=e.extensions;if(p&&!g.a(e.extensions,oe.current.extensions)&&te(d),e!==oe.current&&p){X.current=i.a(ae.current);const d=null===(t=null===(a=e.resources)||void 0===a?void 0:a.sc)||void 0===t?void 0:t.loaded,p=null===(l=null===(r=e.resources)||void 0===r?void 0:r.csi)||void 0===l?void 0:l.loaded,v=(null===(s=null===(n=e.resources)||void 0===n?void 0:n.sc)||void 0===s?void 0:s.data)||[],b=(null===(c=null===(o=e.resources)||void 0===o?void 0:o.csi)||void 0===c?void 0:c.data)||[];p&&(e=>{const a=Object.keys(ee.current);e.forEach(e=>{for(const t of a){const a=Object(j.dd)(e);if(a.includes(t)){const e=i.a(ee.current[t]);e.provisioner=a,X.current[a]=e;break}const r=i.a(Q);r.title=a,r.provisioner=a,X.current[a]=r}})})(b),d&&($.current={data:v,loadError:null===(u=null===(m=e.resources)||void 0===m?void 0:m.sc)||void 0===u?void 0:u.loadError,loaded:d},se())}oe.current=e},[e]);const ie=(e,a,t)=>{const r=Object.assign(Object.assign({},_),{[e]:a});q(r),Z(t)};r.useEffect(()=>{Y&&se()},[_]);const ce=(e,a,t)=>{const r=Object.assign({},_.parameters);t?r[e]={value:a.target.checked}:a.target?r[e]={value:a.target.value}:r[e]={value:a},h.a(r,(e,a)=>{if(r.hasOwnProperty(a)){const e=u.a(X.current[_.type],["parameters",a,"validation"],null);r[a].validationMsg=e?e(r):null}}),ie("parameters",r,!0)},me=(e,a)=>{ie(e,a,!0)},ue=e=>{const a=e.type,t=C.a(N.a(e.parameters,(e,t)=>{var r,l;let n=e.value;return(null===(l=null===(r=X.current[a])||void 0===r?void 0:r.parameters[t])||void 0===l?void 0:l.format)&&(n=X.current[a].parameters[t].format(e.value)),n}),e=>""!==e);return k.a(t,(()=>{const e=E.a(T,e=>b.a(e[D.U.Name])),a=e.map(e=>e[D.U.Name]);if(f.a(a).length===a.length)return c.a(e,e=>e[D.U.Value]=b.a(e[D.U.Value])?null:e[D.U.Value]),y.a(e);H(l("public~Duplicate keys found."))})())},de=null===_.reclaim?re.Delete:_.reclaim,pe=_.volumeBindingMode||le.WaitForFirstConsumer,ve=null===(t=null===(a=X.current)||void 0===a?void 0:a[_.type])||void 0===t?void 0:t.allowVolumeExpansion,be=_.type&&(d.a(ve)?ve(_.parameters):ve),ge=!!be&&_.expansion;return r.createElement("div",{className:"co-m-pane__form"},r.createElement(D.Z,{title:l("public~StorageClass"),link:r.createElement(n.Link,{to:"/k8s/cluster/storageclasses/~new",id:"yaml-link","data-test":"yaml-link",replace:!0},l("public~Edit YAML"))}),r.createElement("div",{className:"co-m-pane__body co-m-pane__body--no-top-margin"},r.createElement("form",{"data-test-id":"storage-class-form"},r.createElement("div",{className:s("form-group",{"has-error":J.nameValidationMsg})},r.createElement("label",{className:"control-label co-required",htmlFor:"storage-class-name"},l("public~Name")),r.createElement("input",{type:"text",className:"pf-v5-c-form-control",placeholder:_.name,id:"storage-class-name","data-test":"storage-class-name",onChange:e=>me("name",e.target.value.trim()),value:u.a(_,"name","")}),r.createElement("span",{className:"help-block"},J.nameValidationMsg?J.nameValidationMsg:null)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"storage-class-description"},l("public~Description")),r.createElement("input",{type:"text",className:"pf-v5-c-form-control",id:"storage-class-description","data-test":"storage-class-description",onChange:e=>me("description",e.target.value),value:u.a(_,"description","")})),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"co-required",htmlFor:"storage-class-reclaim-policy"},l("public~Reclaim policy")),r.createElement(D.t,{title:l("public~Select reclaim policy"),items:re,dropDownClassName:"dropdown--full-width",selectedKey:de,onChange:e=>me("reclaim",e),id:"storage-class-reclaim-policy"}),r.createElement("span",{className:"help-block"},l('public~Determines what happens to persistent volumes when the associated persistent volume claim is deleted. Defaults to "Delete"'))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"co-required",htmlFor:"storage-class-volume-binding-mode"},l("public~Volume binding mode")),r.createElement(D.t,{title:l("public~Select volume binding mode"),items:le,dropDownClassName:"dropdown--full-width",selectedKey:pe,onChange:e=>me("volumeBindingMode",e),id:"storage-class-volume-binding-mode",dataTest:"storage-class-volume-binding-mode"}),r.createElement("span",{className:"help-block"},l('public~Determines when persistent volume claims will be provisioned and bound. Defaults to "WaitForFirstConsumer"'))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"co-required",htmlFor:"storage-class-provisioner"},l("public~Provisioner")),r.createElement(D.t,{title:l("public~Select Provisioner"),autocompleteFilter:(e,a)=>o(e,a),autocompletePlaceholder:l("public~Select Provisioner"),items:N.a(X.current,"provisioner"),dropDownClassName:"dropdown--full-width",menuClassName:"dropdown-menu--text-wrap",selectedKey:_.type,onChange:e=>me("type",e),id:"storage-class-provisioner",dataTest:"storage-class-provisioner-dropdown"}),r.createElement("span",{className:"help-block"},l("public~Determines what volume plugin is used for provisioning PersistentVolumes."))),r.createElement("div",{className:"co-form-subsection"},null!==_.type?(()=>{var e,a;const t=null===(e=X.current[_.type])||void 0===e?void 0:e.parameters,n=w.a(t,(e,a)=>{var t,l;const n="storage-class-provisioner-"+S.a(u.a(e,"name",a)),o=u.a(e,"validationMsg",null),i="checkbox"===e.type,c=["parameters",a,"value"],m=null===(t=null==e?void 0:e.visible)||void 0===t||t;if(!(d.a(m)?m(_.parameters):m))return null;if(e.Component){const{Component:t}=e;return r.createElement(t,{key:a,parameterKey:a,parameterValue:(null===(l=_.parameters[a])||void 0===l?void 0:l.value)||"",onParamChange:ce})}const p=e.values?r.createElement(r.Fragment,null,r.createElement("label",{className:s("control-label",{"co-required":ne(a)}),htmlFor:n},u.a(e,"name",a)),r.createElement(D.t,{title:e.hintText,items:e.values,dropDownClassName:"dropdown--full-width",selectedKey:u.a(_,c),onChange:e=>ce(a,e,!1),id:n,dataTest:n}),r.createElement("span",{className:"help-block"},o||null)):r.createElement(r.Fragment,null,i?r.createElement(r.Fragment,null,r.createElement("div",{className:"checkbox"},r.createElement("label",null,r.createElement("input",{type:"checkbox",className:"create-storage-class-form__checkbox",onChange:e=>ce(a,e,i),checked:u.a(_,c,!1),id:`provisioner-settings-${a}-checkbox`,"data-test":n}),u.a(e,"name",a)))):r.createElement(r.Fragment,null,r.createElement("label",{className:s("control-label",{"co-required":ne(a)}),htmlFor:n},u.a(e,"name",a)),r.createElement("input",{type:"text",className:"pf-v5-c-form-control",value:u.a(_,c,""),onChange:e=>ce(a,e,i),id:n,"data-test":n})),r.createElement("span",{className:"help-block"},o||e.hintText));return r.createElement("div",{key:a,className:s("form-group",{"has-error":u.a(_.parameters,a+".validationMsg",null)})},p)}),o=null===(a=X.current[_.type])||void 0===a?void 0:a.documentationLink;return r.createElement(r.Fragment,null,!b.a(t)&&n,r.createElement("div",{className:"form-group"},r.createElement("label",null,l("public~Additional parameters")),r.createElement("p",null,l("public~Specific fields for the selected provisioner."),"Â ",o&&r.createElement(D.z,{href:o(),text:l("public~What should I enter here?")})),r.createElement(R,{nameValuePairs:T,nameString:l("public~Parameter"),nameParameter:l("public~parameter"),valueString:l("public~Value"),addString:l("public~Add Parameter"),updateParentData:e=>K(e.nameValuePairs)})))})():null),be&&r.createElement("div",{className:"checkbox"},r.createElement("label",null,r.createElement("input",{type:"checkbox",className:"create-storage-class-form__checkbox",onChange:e=>me("expansion",e.target.checked),checked:ge}),l("public~Allow PersistentVolumeClaims to be expanded"))),r.createElement(D.g,{errorMessage:A?A.message:"",inProgress:U},r.createElement(x.a,{className:"pf-v5-c-form"},r.createElement(F.a,{id:"save-changes",isDisabled:!L,onClick:e=>{var a,t;e.preventDefault(),B(!0),H(null);const r=(()=>{var e,a,t;const r=null!==(t=null===(a=null===(e=X.current)||void 0===e?void 0:e[null==_?void 0:_.type])||void 0===a?void 0:a.parameters)&&void 0!==t?t:{},l={};c.a(r,(e,a)=>{var t;!(d.a(null==e?void 0:e.visible)?e.visible(r):null===(t=null==e?void 0:e.visible)||void 0===t||t)&&e.value&&(l[a]=e)});const n=Object.assign(Object.assign({},_.parameters),l);return Object.assign(Object.assign({},_),{parameters:n})})(),{name:l,description:n,type:s,reclaim:o,expansion:i,volumeBindingMode:m}=r,u=ue(r);let p={metadata:{name:l,annotations:n?{description:n}:{}},provisioner:X.current[s].provisioner,parameters:u};o&&(p.reclaimPolicy=o),m&&(p.volumeBindingMode=m);const v=null===(t=null===(a=X.current)||void 0===a?void 0:a[s])||void 0===t?void 0:t.allowVolumeExpansion;(d.a(v)?v(_.parameters):v)&&(p.allowVolumeExpansion=i);const{mutator:b}=X.current[s];d.a(b)&&(p=b(p)),Object(M.jb)(I.StorageClassModel,p).then(e=>{B(!1),P(Object(D.sc)(e,Object(M.Db)(e)))}).catch(e=>{B(!1),H(e)})},type:"submit",variant:"primary"},l("public~Create")),r.createElement(F.a,{id:"cancel",onClick:()=>P("/k8s/cluster/storageclasses"),type:"button",variant:"secondary"},l("public~Cancel")))))))},q=Object(l.connect)(({k8s:e},{onClose:a})=>({k8s:e,onClose:a}),()=>({stopK8sWatch:P.d,watchK8sList:P.e}))(e=>{const a=Object(V.kc)(V.Ub);return r.createElement(_,Object.assign({extensions:a},e))}),T=e=>{const a=[{kind:I.StorageClassModel.kind,isList:!0,prop:"sc"},{kind:Object(M.Hb)(I.CSIDriverModel),isList:!0,prop:"csi"}];return r.createElement(D.C,{resources:a},r.createElement(q,Object.assign({},e)))};q.displayName="StorageClassForm"}}]);
//# sourceMappingURL=storage-class-form-chunk-9170d96371152bcb6550.min.js.map