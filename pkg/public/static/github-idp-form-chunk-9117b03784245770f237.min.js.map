{"version":3,"sources":["webpack:///./public/components/cluster-settings/github-idp-form.tsx","webpack:///./public/components/cluster-settings/index.ts","webpack:///./public/components/cluster-settings/idp-name-input.tsx","webpack:///./public/components/cluster-settings/idp-cafile-input.tsx"],"names":["AddGitHubPage","navigate","inProgress","setInProgress","errorMessage","setErrorMessage","name","setName","clientID","setClientID","clientSecret","setClientSecret","hostname","setHostname","organizations","setOrganizations","teams","setTeams","caFileContent","setCaFileContent","t","handlePromise","promise","then","res","thenPromise","error","err","message","Promise","reject","catchError","createClientSecret","secret","apiVersion","kind","metadata","generateName","namespace","stringData","createCAConfigMap","resolve","ca","data","addGitHubIDP","oauth","clientSecretName","caName","dryRun","idp","type","mappingMethod","github","title","className","helpText","onSubmit","e","preventDefault","length","mockCA","promises","all","configMap","catch","value","onChange","currentTarget","htmlFor","id","required","c","ns","i18nKey","label","variant","onClick","getOAuthResource","addIDP","patch","spec","identityProviders","op","path","queryParams","redirectToOAuthPage","mockNames","IDPNameInput","DroppableFileInput","props","loader","IDPCAFileInput","isRequired","inputFileData","hideContents"],"mappings":"6FAAA,6JAaO,MAAMA,EAAgB,KAC3B,MAAMC,EAAW,yBACVC,EAAYC,GAAiB,YAAe,IAC5CC,EAAcC,GAAmB,WAAe,KAChDC,EAAMC,GAAW,WAAe,WAChCC,EAAUC,GAAe,WAAe,KACxCC,EAAcC,GAAmB,WAAe,KAChDC,EAAUC,GAAe,WAAe,KACxCC,EAAeC,GAAoB,WAAe,KAClDC,EAAOC,GAAY,WAAe,KAClCC,EAAeC,GAAoB,WAAe,KAEnD,EAAEC,GAAM,2BAeRC,EAAiBC,IACrBnB,GAAc,GAEPmB,EAAQC,KACZC,GAjBe,CAACA,IACnBrB,GAAc,GACdE,EAAgB,IACTmB,GAcIC,CAAYD,GACpBE,GAZc,CAACA,IAClB,MAAMC,EAAMD,EAAME,SAAWR,EAAE,+CAG/B,OAFAjB,GAAc,GACdE,EAAgBsB,GACTE,QAAQC,OAAOH,IAQTI,CAAWL,KAQpBM,EAAqB,KACzB,MAAMC,EAAS,CACbC,WAAY,KACZC,KAAM,SACNC,SAAU,CACRC,aAAc,wBACdC,UAAW,oBAEbC,WAAY,CACV7B,iBAIJ,OAAOW,EAAc,aAAU,cAAaY,KAGxCO,EAAoB,KACxB,IAAKtB,EACH,OAAOW,QAAQY,QAAQ,MAGzB,MAAMC,EAAK,CACTR,WAAY,KACZC,KAAM,YACNC,SAAU,CACRC,aAAc,aACdC,UAAW,oBAEbK,KAAM,CACJ,SAAUzB,IAId,OAAOG,EAAc,aAAU,iBAAgBqB,KAG3CE,EAAe,CACnBC,EACAC,EACAC,EACAC,KAEA,MAAMC,EAAwB,CAC5B3C,OACA4C,KAAM,SACNC,cAAe,QACfC,OAAQ,CACN5C,WACAE,aAAc,CACZJ,KAAMwC,GAERlC,WACAE,gBACAE,UAUJ,OANI+B,IACFE,EAAIG,OAAOV,GAAK,CACdpC,KAAMyC,IAIH1B,EAAc,YAAOwB,EAAOI,EAAKD,KAiCpCK,EAAQjC,EAAE,wCAEhB,OACE,uBAAKkC,UAAU,mBACb,gBAAC,IAAM,KACL,6BAAQD,IAEV,gBAAC,IAAW,CACVA,MAAOA,EACPE,SAAUnC,EACR,4PAGJ,uBAAKkC,UAAU,mBACb,wBAAME,SA5CIC,IACdA,EAAEC,iBACE5C,EAAc6C,OAAS,GAAK3C,EAAM2C,OAAS,EAC7CtD,EAAgBe,EAAE,iEAKpBf,EAAgB,IA7ETgB,EAAc,eA8EFE,KAAMsB,IACvB,MAAMe,EAAS1C,EAAgB,IAAUwB,GAAK,GAC9CE,EAAaC,EAAO,IAAUZ,OAAQ2B,GAAQ,GAC3CrC,KAAK,KACJ,MAAMsC,EAAW,CAAC7B,IAAsBQ,KAExCX,QAAQiC,IAAID,GACTtC,KAAK,EAAEU,EAAQ8B,MACd,MAAMhB,EAASgB,EAAYA,EAAU3B,SAAS9B,KAAO,GACrD,OAAOsC,EAAaC,EAAOZ,EAAOG,SAAS9B,KAAMyC,KAElDxB,KAAK,KACJ,YAAoBtB,OAGzB+D,MAAOrC,IACNtB,EAAgBsB,SAmBMrB,KAAK,OAAOgD,UAAU,yBAC5C,gBAAC,IAAY,CAACW,MAAO3D,EAAM4D,SAAWT,GAAMlD,EAAQkD,EAAEU,cAAcF,SACpE,uBAAKX,UAAU,cACb,yBAAOA,UAAU,4BAA4Bc,QAAQ,aAClDhD,EAAE,qBAEL,yBACEkC,UAAU,uBACVJ,KAAK,OACLgB,SAAWT,GAAMhD,EAAYgD,EAAEU,cAAcF,OAC7CA,MAAOzD,EACP6D,GAAG,YACHC,UAAQ,KAGZ,uBAAKhB,UAAU,cACb,yBAAOA,UAAU,4BAA4Bc,QAAQ,iBAClDhD,EAAE,yBAEL,yBACEkC,UAAU,uBACVJ,KAAK,WACLgB,SAAWT,GAAM9C,EAAgB8C,EAAEU,cAAcF,OACjDA,MAAOvD,EACP2D,GAAG,gBACHC,UAAQ,KAGZ,uBAAKhB,UAAU,cACb,yBAAOA,UAAU,gBAAgBc,QAAQ,YACtChD,EAAE,oBAEL,yBACEkC,UAAU,uBACVJ,KAAK,OACLgB,SAAWT,GAAM5C,EAAY4C,EAAEU,cAAcF,OAC7CA,MAAOrD,EACPyD,GAAG,WAAU,mBACI,sBAEnB,qBAAGf,UAAU,aAAae,GAAG,qBAC1BjD,EAAE,iFAGP,gBAAC,IAAc,CAAC6C,MAAO/C,EAAegD,SAAWK,GAAcpD,EAAiBoD,KAChF,uBAAKjB,UAAU,+BACf,0BAAKlC,EAAE,yBACP,qBAAGkC,UAAU,gBACX,gBAAC,QAAK,CACJlC,EAAGA,EACHoD,GAAG,SACHC,QAAQ,qN,6LAIS,uC,MAGrB,gBAAC,IAAS,CACRC,MAAOtD,EAAE,uBACT8C,SAAWK,GAAgBxD,EAAiBwD,GAC5ChB,SAAUnC,EAAE,iEAEd,uBAAKkC,UAAU,+BACf,0BAAKlC,EAAE,iBACP,qBAAGkC,UAAU,gBACX,gBAAC,QAAK,CACJlC,EAAGA,EACHoD,GAAG,SACHC,QAAQ,6M,4KAG8E,IACtF,+C,MAGJ,gBAAC,IAAS,CACRC,MAAOtD,EAAE,eACT8C,SAAWK,GAAgBtD,EAASsD,GACpChB,SAAUnC,EACR,qFAGJ,gBAAC,IAAS,CAAChB,aAAcA,EAAcF,WAAYA,GACjD,gBAAC,IAAW,CAACoD,UAAU,gBACrB,gBAAC,IAAM,CAACJ,KAAK,SAASyB,QAAQ,UAAS,eAAc,WAClDvD,EAAE,eAEL,gBAAC,IAAM,CAAC8B,KAAK,SAASyB,QAAQ,YAAYC,QAAS,IAAM3E,GAAU,IAChEmB,EAAE,yB,kCC5PnB,0KAOA,MAEayD,EAAmB,IAA0B,aAAO,aAFrC,WAIfC,EAAS,CACpBjC,EACAI,EACAD,KAEA,MAAM+B,EAAQ,IAAUlC,EAAMmC,KAAKC,mBAC/B,CAAEC,GAAI,MAAOC,KAAM,0BAA2BlB,MAAO,CAAChB,IACtD,CAAEiC,GAAI,MAAOC,KAAM,4BAA6BlB,MAAOhB,GAC3D,OAAO,aAAS,aAAYJ,EAAO,CAACkC,GAAQ/B,EAAS,CAAEoC,YAAa,CAAEpC,OAAQ,QAAY,KAG/EqC,EAAuBpF,IAElCA,EADgB,aAAsB,aAhBZ,WAgBb,mBAIFqF,EAAY,CACvBrD,OAAQ,cACRS,GAAI,Y,kCC7BN,oDAGO,MAAM6C,EAA4C,EAAGtB,QAAOC,eACjE,MAAM,EAAE9C,GAAM,2BACd,OACE,uBAAKkC,UAAU,cACb,yBAAOA,UAAU,4BAA4Bc,QAAQ,YAClDhD,EAAE,gBAEL,yBACEkC,UAAU,uBACVJ,KAAK,OACLgB,SAAUA,EACVD,MAAOA,EAAK,mBACK,gBACjBI,GAAG,WACHC,UAAQ,IAEV,qBAAGhB,UAAU,aAAae,GAAG,iBAC1BjD,EAAE,sF,kCCpBX,2DAIA,MAAMoE,EAAsBC,GAC1B,gBAAC,IAAc,eACbC,OAAQ,IAAM,0CAA8BnE,KAAMgD,GAAMA,EAAEiB,qBACtDC,IAIKE,EAAgD,EAC3D1B,QACAC,WACA0B,cAAa,MAEb,MAAM,EAAExE,GAAM,2BACd,OACE,uBAAKkC,UAAU,cACb,gBAACkC,EAAkB,CACjBtB,SAAUA,EACV2B,cAAe5B,EACfI,GAAG,iBACHK,MAAOtD,EAAE,kBACTwE,WAAYA,EACZE,cAAY","file":"github-idp-form-chunk-9117b03784245770f237.min.js","sourcesContent":["import * as React from 'react';\nimport { Helmet } from 'react-helmet';\nimport { useTranslation, Trans } from 'react-i18next';\nimport { useNavigate } from 'react-router-dom-v5-compat';\nimport { ActionGroup, Button } from '@patternfly/react-core';\n\nimport { SecretModel, ConfigMapModel } from '../../models';\nimport { IdentityProvider, k8sCreate, OAuthKind } from '../../module/k8s';\nimport { ButtonBar, ListInput, PageHeading } from '../utils';\nimport { addIDP, getOAuthResource as getOAuth, redirectToOAuthPage, mockNames } from './';\nimport { IDPNameInput } from './idp-name-input';\nimport { IDPCAFileInput } from './idp-cafile-input';\n\nexport const AddGitHubPage = () => {\n  const navigate = useNavigate();\n  const [inProgress, setInProgress] = React.useState(false);\n  const [errorMessage, setErrorMessage] = React.useState('');\n  const [name, setName] = React.useState('github');\n  const [clientID, setClientID] = React.useState('');\n  const [clientSecret, setClientSecret] = React.useState('');\n  const [hostname, setHostname] = React.useState('');\n  const [organizations, setOrganizations] = React.useState([]);\n  const [teams, setTeams] = React.useState([]);\n  const [caFileContent, setCaFileContent] = React.useState('');\n\n  const { t } = useTranslation();\n\n  const thenPromise = (res) => {\n    setInProgress(false);\n    setErrorMessage('');\n    return res;\n  };\n\n  const catchError = (error) => {\n    const err = error.message || t('public~An error occurred. Please try again.');\n    setInProgress(false);\n    setErrorMessage(err);\n    return Promise.reject(err);\n  };\n\n  const handlePromise = (promise) => {\n    setInProgress(true);\n\n    return promise.then(\n      (res) => thenPromise(res),\n      (error) => catchError(error),\n    );\n  };\n\n  const getOAuthResource = () => {\n    return handlePromise(getOAuth());\n  };\n\n  const createClientSecret = () => {\n    const secret = {\n      apiVersion: 'v1',\n      kind: 'Secret',\n      metadata: {\n        generateName: 'github-client-secret-',\n        namespace: 'openshift-config',\n      },\n      stringData: {\n        clientSecret,\n      },\n    };\n\n    return handlePromise(k8sCreate(SecretModel, secret));\n  };\n\n  const createCAConfigMap = () => {\n    if (!caFileContent) {\n      return Promise.resolve(null);\n    }\n\n    const ca = {\n      apiVersion: 'v1',\n      kind: 'ConfigMap',\n      metadata: {\n        generateName: 'github-ca-',\n        namespace: 'openshift-config',\n      },\n      data: {\n        'ca.crt': caFileContent,\n      },\n    };\n\n    return handlePromise(k8sCreate(ConfigMapModel, ca));\n  };\n\n  const addGitHubIDP = (\n    oauth: OAuthKind,\n    clientSecretName: string,\n    caName: string,\n    dryRun?: boolean,\n  ) => {\n    const idp: IdentityProvider = {\n      name,\n      type: 'GitHub',\n      mappingMethod: 'claim',\n      github: {\n        clientID,\n        clientSecret: {\n          name: clientSecretName,\n        },\n        hostname,\n        organizations,\n        teams,\n      },\n    };\n\n    if (caName) {\n      idp.github.ca = {\n        name: caName,\n      };\n    }\n\n    return handlePromise(addIDP(oauth, idp, dryRun));\n  };\n\n  const submit = (e) => {\n    e.preventDefault();\n    if (organizations.length > 0 && teams.length > 0) {\n      setErrorMessage(t('public~Specify either organizations or teams, but not both.'));\n      return;\n    }\n\n    // Clear any previous errors.\n    setErrorMessage('');\n    getOAuthResource().then((oauth: OAuthKind) => {\n      const mockCA = caFileContent ? mockNames.ca : '';\n      addGitHubIDP(oauth, mockNames.secret, mockCA, true)\n        .then(() => {\n          const promises = [createClientSecret(), createCAConfigMap()];\n\n          Promise.all(promises)\n            .then(([secret, configMap]) => {\n              const caName = configMap ? configMap.metadata.name : '';\n              return addGitHubIDP(oauth, secret.metadata.name, caName);\n            })\n            .then(() => {\n              redirectToOAuthPage(navigate);\n            });\n        })\n        .catch((err) => {\n          setErrorMessage(err);\n        });\n    });\n  };\n\n  const title = t('public~Add Identity Provider: GitHub');\n\n  return (\n    <div className=\"co-m-pane__form\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <PageHeading\n        title={title}\n        helpText={t(\n          'public~You can use the GitHub integration to connect to either GitHub or GitHub Enterprise. For GitHub Enterprise, you must provide the hostname of your instance and can optionally provide a CA certificate bundle to use in requests to the server.',\n        )}\n      />\n      <div className=\"co-m-pane__body\">\n        <form onSubmit={submit} name=\"form\" className=\"co-m-pane__body-group\">\n          <IDPNameInput value={name} onChange={(e) => setName(e.currentTarget.value)} />\n          <div className=\"form-group\">\n            <label className=\"control-label co-required\" htmlFor=\"client-id\">\n              {t('public~Client ID')}\n            </label>\n            <input\n              className=\"pf-v5-c-form-control\"\n              type=\"text\"\n              onChange={(e) => setClientID(e.currentTarget.value)}\n              value={clientID}\n              id=\"client-id\"\n              required\n            />\n          </div>\n          <div className=\"form-group\">\n            <label className=\"control-label co-required\" htmlFor=\"client-secret\">\n              {t('public~Client secret')}\n            </label>\n            <input\n              className=\"pf-v5-c-form-control\"\n              type=\"password\"\n              onChange={(e) => setClientSecret(e.currentTarget.value)}\n              value={clientSecret}\n              id=\"client-secret\"\n              required\n            />\n          </div>\n          <div className=\"form-group\">\n            <label className=\"control-label\" htmlFor=\"hostname\">\n              {t('public~Hostname')}\n            </label>\n            <input\n              className=\"pf-v5-c-form-control\"\n              type=\"text\"\n              onChange={(e) => setHostname(e.currentTarget.value)}\n              value={hostname}\n              id=\"hostname\"\n              aria-describedby=\"idp-hostname-help\"\n            />\n            <p className=\"help-block\" id=\"idp-hostname-help\">\n              {t('public~Optional domain for use with a hosted instance of GitHub Enterprise.')}\n            </p>\n          </div>\n          <IDPCAFileInput value={caFileContent} onChange={(c: string) => setCaFileContent(c)} />\n          <div className=\"co-form-section__separator\" />\n          <h3>{t('public~Organizations')}</h3>\n          <p className=\"co-help-text\">\n            <Trans\n              t={t}\n              ns=\"public\"\n              i18nKey=\"Optionally list organizations. If specified, only GitHub users that are members of at least one of the listed organizations will be allowed to log in. Cannot be used in combination with <strong>teams</strong>.\"\n            >\n              Optionally list organizations. If specified, only GitHub users that are members of at\n              least one of the listed organizations will be allowed to log in. Cannot be used in\n              combination with <strong>teams</strong>.\n            </Trans>\n          </p>\n          <ListInput\n            label={t('public~Organization')}\n            onChange={(c: string[]) => setOrganizations(c)}\n            helpText={t('public~Restricts which organizations are allowed to log in.')}\n          />\n          <div className=\"co-form-section__separator\" />\n          <h3>{t('public~Teams')}</h3>\n          <p className=\"co-help-text\">\n            <Trans\n              t={t}\n              ns=\"public\"\n              i18nKey=\"Optionally list teams. If specified, only GitHub users that are members of at least one of the listed teams will be allowed to log in. Cannot be used in combination with <strong>organizations</strong>.\"\n            >\n              Optionally list teams. If specified, only GitHub users that are members of at least\n              one of the listed teams will be allowed to log in. Cannot be used in combination with{' '}\n              <strong>organizations</strong>.\n            </Trans>\n          </p>\n          <ListInput\n            label={t('public~Team')}\n            onChange={(c: string[]) => setTeams(c)}\n            helpText={t(\n              'public~Restricts which teams are allowed to log in. The format is <org>/<team>.',\n            )}\n          />\n          <ButtonBar errorMessage={errorMessage} inProgress={inProgress}>\n            <ActionGroup className=\"pf-v5-c-form\">\n              <Button type=\"submit\" variant=\"primary\" data-test-id=\"add-idp\">\n                {t('public~Add')}\n              </Button>\n              <Button type=\"button\" variant=\"secondary\" onClick={() => navigate(-1)}>\n                {t('public~Cancel')}\n              </Button>\n            </ActionGroup>\n          </ButtonBar>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport type AddGitHubPageState = {\n  name: string;\n  clientID: string;\n  clientSecret: string;\n  hostname: string;\n  organizations: string[];\n  teams: string[];\n  caFileContent: string;\n  inProgress: boolean;\n  errorMessage: string;\n};\n","import * as _ from 'lodash-es';\n\nimport { OAuthModel } from '../../models';\nimport { IdentityProvider, k8sGet, k8sPatch, OAuthKind } from '../../module/k8s';\nimport { resourcePathFromModel } from '../utils';\n\n// The name of the cluster-scoped OAuth configuration resource.\nconst OAUTH_RESOURCE_NAME = 'cluster';\n\nexport const getOAuthResource = (): Promise<OAuthKind> => k8sGet(OAuthModel, OAUTH_RESOURCE_NAME);\n\nexport const addIDP = (\n  oauth: OAuthKind,\n  idp: IdentityProvider,\n  dryRun?: boolean,\n): Promise<OAuthKind> => {\n  const patch = _.isEmpty(oauth.spec.identityProviders)\n    ? { op: 'add', path: '/spec/identityProviders', value: [idp] }\n    : { op: 'add', path: '/spec/identityProviders/-', value: idp };\n  return k8sPatch(OAuthModel, oauth, [patch], dryRun ? { queryParams: { dryRun: 'All' } } : {});\n};\n\nexport const redirectToOAuthPage = (navigate) => {\n  const path = `${resourcePathFromModel(OAuthModel, OAUTH_RESOURCE_NAME)}?idpAdded=true`;\n  navigate(path);\n};\n\nexport const mockNames = {\n  secret: 'secret-name',\n  ca: 'ca-name',\n};\n","import * as React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const IDPNameInput: React.FC<IDPNameInputProps> = ({ value, onChange }) => {\n  const { t } = useTranslation();\n  return (\n    <div className=\"form-group\">\n      <label className=\"control-label co-required\" htmlFor=\"idp-name\">\n        {t('public~Name')}\n      </label>\n      <input\n        className=\"pf-v5-c-form-control\"\n        type=\"text\"\n        onChange={onChange}\n        value={value}\n        aria-describedby=\"idp-name-help\"\n        id=\"idp-name\"\n        required\n      />\n      <p className=\"help-block\" id=\"idp-name-help\">\n        {t('public~Unique name of the new identity provider. This cannot be changed later.')}\n      </p>\n    </div>\n  );\n};\n\ntype IDPNameInputProps = {\n  value: string;\n  onChange: React.ReactEventHandler<HTMLInputElement>;\n};\n","import * as React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { AsyncComponent } from '../utils';\n\nconst DroppableFileInput = (props: any) => (\n  <AsyncComponent\n    loader={() => import('../utils/file-input').then((c) => c.DroppableFileInput)}\n    {...props}\n  />\n);\n\nexport const IDPCAFileInput: React.FC<IDPCAFileInputProps> = ({\n  value,\n  onChange,\n  isRequired = false,\n}) => {\n  const { t } = useTranslation();\n  return (\n    <div className=\"form-group\">\n      <DroppableFileInput\n        onChange={onChange}\n        inputFileData={value}\n        id=\"idp-file-input\"\n        label={t('public~CA file')}\n        isRequired={isRequired}\n        hideContents\n      />\n    </div>\n  );\n};\n\ntype IDPCAFileInputProps = {\n  value: string;\n  onChange: (value: string) => void;\n  isRequired?: boolean;\n};\n"],"sourceRoot":""}