(window.webpackJsonp=window.webpackJsonp||[]).push([[269],{5476:function(e,t,a){"use strict";a.r(t),a.d(t,"rollbackModal",(function(){return k}));var l=a(0),n=a(1033),o=a(7),c=a(15),r=a(118),s=a(5),i=a(10),m=a(8),p=a(108),u=a(80);const d=["kubectl.kubernetes.io/last-applied-configuration","deployment.kubernetes.io/revision","deployment.kubernetes.io/revision-history","deployment.kubernetes.io/desired-replicas","deployment.kubernetes.io/max-replicas","deprecated.deployment.rollback.to"],b=Object(s.Oc)(e=>{const{t:t}=Object(o.useTranslation)(),a=e.resource.kind===i.ReplicationControllerModel.kind,b=Object(c.qd)(e.resource,a?i.DeploymentConfigModel:i.DeploymentModel),[k,y]=l.useState(!1),[g,h]=l.useState(!1),[E,f]=l.useState(!1),v={kind:a?i.DeploymentConfigModel.kind:i.DeploymentModel.kind,isList:!1,name:b,namespace:e.resource.metadata.namespace},[M,D,N]=Object(p.a)(v),[j,O]=l.useState();l.useEffect(()=>{D&&!N&&M&&M.spec.paused&&O(t("public~You cannot rollback a paused {{ deployType }}. You must resume it first.",{deployType:a?i.DeploymentConfigModel.label:i.DeploymentModel.label}))},[M,a,N,D,t]);return l.createElement("form",{onSubmit:t=>(t.preventDefault(),a?(()=>{const t=Object(c.Ic)(e.resource),a={kind:"DeploymentConfigRollback",apiVersion:"apps.openshift.io/v1",name:b,latest:!0,force:!0,spec:{from:{},revision:t,includeTemplate:!0,includeReplicationMeta:k,includeStrategy:g,includeTriggers:E}},l={name:b,ns:e.resource.metadata.namespace,path:"rollback"};return e.handlePromise(Object(m.jb)(i.DeploymentConfigModel,a,l).then(e=>Object(m.rb)(i.DeploymentConfigModel,e)),e.close)})():(()=>{const t=n.a(e.resource.spec.template);delete t.metadata.labels["pod-template-hash"];const a={};d.forEach(e=>{M.metadata.annotations[e]&&(a[e]=M.metadata.annotations[e])}),Object.keys(e.resource.metadata.annotations).forEach(t=>{d.includes(t)||(a[t]=e.resource.metadata.annotations[t])});const l=[{op:"replace",path:"/spec/template",value:t},{op:"replace",path:"/metadata/annotations",value:a}];return e.handlePromise(Object(m.pb)(i.DeploymentModel,M,l),e.close)})()),name:"form",className:"modal-content"},l.createElement(r.d,null,t("public~Rollback")),l.createElement(r.a,null,D?N||j?l.createElement(u.a,{isInline:!0,className:"co-alert co-alert--scrollable",variant:"danger",title:t("public~Unable to Rollback")},l.createElement("div",{className:"co-pre-line"},(null==N?void 0:N.message)||j)):e.resource.kind===i.ReplicationControllerModel.kind?l.createElement(l.Fragment,null,l.createElement("p",null,l.createElement(o.Trans,{t:t,ns:"public"},"Use the following settings from"," ",l.createElement("strong",{className:"co-break-word"},{resourceName:e.resource.metadata.name})," ","when rolling back:")),l.createElement("div",{className:"checkbox"},l.createElement("label",{className:"control-label"},l.createElement("input",{type:"checkbox",onChange:()=>y(!k),checked:k}),t("public~Replica count and selector"))),l.createElement("div",{className:"checkbox"},l.createElement("label",{className:"control-label"},l.createElement("input",{type:"checkbox",onChange:()=>h(!g),checked:g}),t("public~Deployment strategy"))),l.createElement("div",{className:"checkbox"},l.createElement("label",{className:"control-label"},l.createElement("input",{type:"checkbox",onChange:()=>f(!E),checked:E}),t("public~Deployment trigger")))):l.createElement("p",null,l.createElement(o.Trans,{t:t,ns:"public"},"Are you sure you want to rollback to"," ",l.createElement("strong",{className:"co-break-word"},{resourceName:e.resource.metadata.name}),"?")):l.createElement(s.T,null)),l.createElement(r.c,{errorMessage:e.errorMessage,inProgress:!1,submitText:t("public~Rollback"),cancel:e.cancel,submitDisabled:(null==N?void 0:N.message)||j}))}),k=Object(r.f)(e=>l.createElement(b,Object.assign({},e)))}}]);
//# sourceMappingURL=rollback-modal-chunk-de5248f4a27e4df91e75.min.js.map