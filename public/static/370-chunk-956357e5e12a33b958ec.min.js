(window.webpackJsonp=window.webpackJsonp||[]).push([[370],{12053:function(e,t,a){"use strict";a.r(t),a.d(t,"AttachStorageForm",(function(){return N})),a.d(t,"AttachStorage",(function(){return S}));var n=a(16),l=a(117),c=a(240),s=a(4438),o=a(50),r=a(22),i=a(0),u=a(19),m=a(966),p=a(7),d=a(14),h=a(8),v=a(5),b=a(6017),g=a(692),f=a(5424),E=a(10),k=a(12054),C=a(7565);const N=e=>{const[t,a]=i.useState(null),[N,S]=i.useState(!1),[y,w]=i.useState(!1),[P,O]=i.useState(""),[j,D]=i.useState(""),[M,x]=i.useState(""),[T,V]=i.useState(""),[F,$]=i.useState(""),[_,q]=i.useState(!1),[K,A]=i.useState([]),[R,B]=i.useState(!1),[I,J]=i.useState(""),[U,Y]=i.useState("existing"),[L,z]=i.useState(""),[G,H]=i.useState(null),[Q,W]=i.useState(null),{kindObj:X,resourceName:Z,namespace:ee}=e,{t:te}=Object(p.useTranslation)(),ae=Object(d.useNavigate)();if(i.useEffect(()=>{Object(h.kb)(X,Z,ee).then(a)},[X,Z,ee]),i.useEffect(()=>{var e;const a="existing"===U?P:n.a(G,"metadata.name",""),c=n.a(t,"spec.template.spec.volumes"),s=l.a(c,{persistentVolumeClaim:{claimName:a}}),o=s?s.name:a,r=!!s;D(o),B(r),"existing"===U&&a.trim().length>0?z(Q.spec.volumeMode):z(null===(e=null==G?void 0:G.spec)||void 0===e?void 0:e.volumeMode)},[G,t,P,U,L,Q,ee]),!X||!c.a(["Deployment","DeploymentConfig","ReplicaSet","ReplicationController","StatefulSet","DaemonSet"],X.kind))return void J("Unsupported kind.");const ne=e=>{Y(e.currentTarget.value)},le=()=>{w(!y),A([])},ce=({name:e})=>!y||K.includes(e),se=e=>{var a;const l=(a=t.spec.template,n.a(a,"spec.containers",[]).reduce((e,t)=>{if(!ce(t))return e;const a=o.a(t.volumeMounts,"mountPath");return e.concat(a)},[])).includes(e)?"Mount path is already in use.":"";J(l)},oe=e=>{var a,n;(a=t.spec.template,(null===(n=null==a?void 0:a.spec)||void 0===n?void 0:n.containers).reduce((e,t)=>{if(!ce(t))return e;const a=o.a(t.volumeDevices,"devicePath");return e.concat(a)},[])).includes(e)&&J(te("public~Device path is already in use."))},re=e=>{const a="Block"===L?(()=>{var e,a,n;const l={name:j,devicePath:T};return(null===(n=null===(a=null===(e=null==t?void 0:t.spec)||void 0===e?void 0:e.template)||void 0===a?void 0:a.spec)||void 0===n?void 0:n.containers).reduce((e,t,a)=>(ce(t)&&(r.a(t.volumeMounts)?e.push({op:"add",path:`/spec/template/spec/containers/${a}/volumeDevices`,value:[l]}):e.push({op:"add",path:`/spec/template/spec/containers/${a}/volumeDevices/-`,value:l})),e),[])})():(()=>{const e={name:j,mountPath:M,subPath:F,readOnly:_};return n.a(t,"spec.template.spec.containers",[]).reduce((t,a,n)=>(ce(a)&&(r.a(a.volumeMounts)?t.push({op:"add",path:`/spec/template/spec/containers/${n}/volumeMounts`,value:[e]}):t.push({op:"add",path:`/spec/template/spec/containers/${n}/volumeMounts/-`,value:e})),t),[])})(),l={name:j,persistentVolumeClaim:{claimName:e}};if(!R){const e=n.a(t,"spec.template.spec.volumes"),c=r.a(e)?{op:"add",path:"/spec/template/spec/volumes",value:[l]}:{op:"add",path:"/spec/template/spec/volumes/-",value:l};return[...a,c]}return a};return i.createElement("form",{className:"co-m-pane__body-group co-m-pane__form",onSubmit:e=>{e.preventDefault(),y&&0===K.length?J("You must choose at least one container to mount to."):(S(!0),("new"===U?Object(h.jb)(E.PersistentVolumeClaimModel,G).then(e=>e.metadata.name):Promise.resolve(P)).then(e=>Object(h.pb)(X,t,re(e)).then(e=>{S(!1),ae(Object(v.sc)(e,Object(h.Db)(e)))}),e=>{J(e.message),S(!1)}))}},i.createElement("label",{className:"control-label co-required"},te("public~PersistentVolumeClaim")),i.createElement("div",{className:"form-group"},i.createElement(g.b,{title:te("public~Use existing claim"),value:"existing",key:"existing",onChange:ne,checked:"existing"===U,name:"showCreatePVC"})),"existing"===U&&i.createElement("div",{className:"form-group co-form-subsection"},i.createElement(C.a,{namespace:ee,onChange:(e,t,a)=>{O(e),W(a)},id:"claimName",dataTest:"claim-name",selectedKey:P})),i.createElement("div",{className:"form-group"},i.createElement(g.b,{title:te("public~Create new claim"),value:"new",key:"new",onChange:ne,checked:"new"===U,name:"showCreatePVC"})),"new"===U&&i.createElement("div",{className:"co-form-subsection"},i.createElement(f.CreatePVCForm,{onChange:H,namespace:ee})),"Block"===L?i.createElement("div",{className:"form-group"},i.createElement("label",{className:"control-label co-required",htmlFor:"device-path"},te("public~Device path")),i.createElement("div",null,i.createElement("input",{className:"pf-v5-c-form-control",type:"text",onChange:e=>{V(e.currentTarget.value),oe(e.currentTarget.value)},"aria-describedby":"volume-device-help",name:"devicePath",id:"device-path",value:T,required:!0}),i.createElement("p",{className:"help-block",id:"volume-device-help"},te("public~Device path for the block volume inside the container.")))):i.createElement("div",{className:"form-group"},i.createElement("label",{className:"control-label co-required",htmlFor:"mount-path"},te("public~Mount path")),i.createElement("div",null,i.createElement("input",{className:"pf-v5-c-form-control",type:"text",onChange:e=>{x(e.currentTarget.value),se(e.currentTarget.value)},"aria-describedby":"mount-path-help",name:"mountPath",id:"mount-path","data-test":"mount-path",value:M,required:!0}),i.createElement("p",{className:"help-block",id:"mount-path-help"},te("public~Mount path for the volume inside the container."))),i.createElement(b.a,{label:te("public~Mount as read-only"),onChange:()=>{q(!_)},checked:_,name:"mountAsReadOnly"}),i.createElement("div",{className:"form-group"},i.createElement("label",{className:"control-label",htmlFor:"subpath"},te("public~Subpath")),i.createElement("div",null,i.createElement("input",{className:"pf-v5-c-form-control",type:"text",onChange:e=>{$(e.currentTarget.value)},"aria-describedby":"subpath-help",id:"subpath",name:"subPath",value:F}),i.createElement("p",{className:"help-block",id:"subpath-help"},te("public~Optional path within the volume from which it will be mounted into the container. Defaults to the root of the volume."))))),!y&&i.createElement("p",null,i.createElement(p.Trans,{t:te,ns:"public"},"The volume will be mounted into all containers. You can"," ",i.createElement(u.a,{type:"button",onClick:le,variant:"link",isInline:!0},"select specific containers")," ","instead.")),y&&i.createElement("div",{className:"form-group co-break-word"},i.createElement("label",{className:"control-label"},te("public~Containers")),i.createElement(u.a,{type:"button",onClick:le,variant:"link"},te("public~(use all containers)")),i.createElement(k.a,{containers:t.spec.template.spec.containers,selected:K,onChange:(e,t)=>{const a=[...K];t?a.push(e.currentTarget.id):s.a(a,e.currentTarget.id),A(a)}}),i.createElement("p",{className:"help-block",id:"subpath-help"},te("public~Select which containers to mount volume into."))),i.createElement(v.g,{errorMessage:I,inProgress:N},i.createElement(m.a,{className:"pf-v5-c-form"},i.createElement(u.a,{type:"submit",variant:"primary",id:"save-changes",isDisabled:"existing"===U&&!P},te("public~Save")),i.createElement(u.a,{type:"button",variant:"secondary",onClick:()=>ae(-1)},te("public~Cancel")))))},S=({kindObj:e,kindsInFlight:t})=>{const a=Object(d.useParams)();return!e&&t?i.createElement(v.S,null):i.createElement(N,{namespace:a.ns,resourceName:a.name,kindObj:e})}},12054:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(0),l=a(472);const c=({containers:e,onChange:t,selected:a})=>n.createElement("div",{className:"pf-v5-c-form__checkbox-row"},e.map(e=>n.createElement(l.a,{key:e.name,label:`${e.name} from image ${e.image}`,id:e.name,isChecked:a.includes(e.name),"data-checked-state":a.includes(e.name),onChange:t})))},7565:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(0),l=a(1965),c=a(7),s=a(10);const o=e=>{const t=s.PersistentVolumeClaimModel.kind,{namespace:a,selectedKey:o,desc:r}=e,i=[{kind:t,namespace:a}],{t:u}=Object(c.useTranslation)();return n.createElement(l.ListDropdown,Object.assign({},e,{desc:r,resources:i,selectedKeyKind:t,placeholder:u("public~Select claim"),selectedKey:o}))}}}]);
//# sourceMappingURL=370-chunk-956357e5e12a33b958ec.min.js.map