(window.webpackJsonp=window.webpackJsonp||[]).push([[229],{5453:function(e,t,n){"use strict";n.r(t),n.d(t,"useExtensionCatalogDatabaseContextValues",(function(){return u}));var a=n(0),r=n(721),o=n(976),c=n(9592),i=n(6356),s=n(9593);const u=()=>{const[e]=Object(o.xb)({groupVersionKind:c.a,isList:!0}),[t,n]=a.useState(!1),[u,l]=a.useState(),d=a.useRef(r.a(e=>{n(!1),l(null),Object(i.d)("olm").then(t=>Object(s.a)(t,e)).then(()=>{n(!0),l(null)}).catch(e=>{n(!0),l(e)})},5e3));return a.useEffect(()=>{const t=d.current;return t(e),()=>t.cancel()},[e]),{done:t,error:u}};t.default=u},6356:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));const a=(e,t)=>new Promise((n,a)=>{const r=indexedDB.open(e,t);r.onupgradeneeded=()=>{const e=r.result;if(!e.objectStoreNames.contains("olm.package")){e.createObjectStore("olm.package",{keyPath:"id"}).createIndex("catalog","catalog",{unique:!1})}if(!e.objectStoreNames.contains("olm.channel")){const t=e.createObjectStore("olm.channel",{keyPath:"id"});t.createIndex("package","package",{unique:!1}),t.createIndex("catalog","catalog",{unique:!1})}if(!e.objectStoreNames.contains("olm.bundle")){const t=e.createObjectStore("olm.bundle",{keyPath:"id"});t.createIndex("package","package",{unique:!1}),t.createIndex("catalog","catalog",{unique:!1})}if(!e.objectStoreNames.contains("extension-catalog")){const t=e.createObjectStore("extension-catalog",{keyPath:"id"});t.createIndex("categories","categories",{unique:!1,multiEntry:!0}),t.createIndex("keywords","keywords",{unique:!1,multiEntry:!0}),t.createIndex("infrastructureFeatures","infrastructureFeatures",{unique:!1,multiEntry:!0}),t.createIndex("validSubscription","validSubscription",{unique:!1,multiEntry:!0}),t.createIndex("source","source",{unique:!1}),t.createIndex("provider","provider",{unique:!1}),t.createIndex("catalog","catalog",{unique:!1}),t.createIndex("capabilities","capabilities",{unique:!1})}},r.onsuccess=()=>{n(r.result)},r.onerror=()=>{var e;a(new Error("Database error: "+(null===(e=r.error)||void 0===e?void 0:e.message)))}}),r=(e,t,n)=>e.transaction([t],n).objectStore(t),o=(e,t,n)=>new Promise((a,o)=>{const c=r(e,t,"readwrite").put(n);c.onsuccess=()=>a(c.result),c.onerror=()=>o(c.error)}),c=(e,t)=>new Promise((n,a)=>{const o=r(e,t,"readonly").getAll();o.onsuccess=()=>n(o.result),o.onerror=()=>a(o.error)}),i=(e,t,n,a)=>new Promise((r,o)=>{const c=e.transaction(t,"readonly").objectStore(t).index(n),i=IDBKeyRange.only(a),s=c.openCursor(i),u=[];s.onsuccess=()=>{const e=s.result;e?(u.push(e.value),e.continue()):r(u)},s.onerror=()=>{o(s.error)}}),s=(e,...t)=>Promise.all(t.map(t=>((e,t)=>new Promise((n,a)=>{const o=r(e,t,"readwrite").clear();o.onsuccess=()=>n(),o.onerror=()=>a(o.error)}))(e,t)))},6848:function(e,t,n){"use strict";var a,r,o;n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return o})),function(e){e.package="olm.package",e.channel="olm.channel",e.bundle="olm.bundle",e.csvMetadata="olm.csv.metadata"}(a||(a={})),function(e){e.annotations="annotations",e.capabilities="capabilities",e.description="description",e.displayName="displayName",e.provider="provider",e.categories="categories",e.keywords="keywords",e.validSubscription="operators.openshift.io/valid-subscription",e.legacyInfrastructureFeatures="operators.openshift.io/infrastructure-features"}(r||(r={})),function(e){e.validSubscription="validSubscription",e.infrastructureFeatures="infrastructureFeatures",e.longDescription="longDescription"}(o||(o={}))},8242:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return d}));var a=n(283),r=n(6356),o=n(9594),c=n(6848),i=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function c(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}s((a=a.apply(e,t||[])).next())}))};const s=(e,t)=>{var n;return(null!==(n=e.properties)&&void 0!==n?n:[]).some(({type:e})=>e===t)},u=e=>{var t;const n=(null===(t=((e,t)=>{var n,a;return null===(a=(null!==(n=e.properties)&&void 0!==n?n:[]).find(({type:e})=>e===t))||void 0===a?void 0:a.value})(e,c.b.package))||void 0===t?void 0:t.version)||"";return a.parse(n)},l=(e,t)=>{const n=u(e),r=u(t);return a.compare(n,r)},d=(e,t)=>i(void 0,void 0,void 0,(function*(){var n,a;const c=yield Object(r.b)(e,"olm.bundle","package",t).catch(e=>(console.warn(e),[])),[i]=null!==(a=null===(n=null==c?void 0:c.sort)||void 0===n?void 0:n.call(c,l))&&void 0!==a?a:[];return i?Object(o.a)(i):{}}))},9592:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a={group:"catalogd.operatorframework.io",version:"v1alpha1",kind:"ClusterCatalog"}},9593:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var a=n(8242),r=n(6356),o=n(9595),c=n(9596),i=n(9598),s=n(6848),u=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function c(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}s((a=a.apply(e,t||[])).next())}))},l=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};const d=(e,t,n,o)=>n.read().then(({done:c,value:f})=>u(void 0,void 0,void 0,(function*(){var u;if(c)return o;if(Object(i.a)(f)&&!Object(a.a)(f,s.b.csvMetadata))return d(e,t,n,null!=o?o:0);const{schema:p}=f,b=l(f,["schema"]),g=null!==(u=b.package)&&void 0!==u?u:b.name,m="olm.package"===p?"":"~"+b.name,v=`${t}~${g}`,h=`${v}${m}`;return yield Object(r.e)(e,p,Object.assign(Object.assign({},b),{id:h,catalog:t,package:v})),d(e,t,n,(null!=o?o:0)+1)}))),f=(e,t)=>u(void 0,void 0,void 0,(function*(){return console.time("[Extension Catalog Database] took"),console.log("[Extension Catalog Database] Refreshing extension catalog database"),Object(r.a)(e,"olm.package","olm.channel","olm.bundle","extension-catalog").then(()=>(console.log("[Extension Catalog Database] Object stores cleared"),Promise.allSettled(t.map(t=>((e,t)=>u(void 0,void 0,void 0,(function*(){const n=t.metadata.name;return console.log("[Extension Catalog Database] Injesting FBC from ClusterCatalog",n),Object(o.a)(`/api/catalogd/catalogs/${n}/all.json`,{"Content-Type":"application/jsonl"}).then(t=>d(e,n,t)).then(e=>(console.log("[Extension Catalog Database] Successfully injested",e,"objects from ClusterCatalog",n),e)).catch(e=>(console.warn("[Extension Catalog Database} Failed to injest FBC from ClusterCatalog",n,e.toString()),0))})))(e,t))))).then(t=>{const n=t.reduce((e,t)=>"fulfilled"===t.status?e+t.value:e,0);return console.log("[Extension Catalog Database]",n,"items populated to FBC object stores"),(e=>u(void 0,void 0,void 0,(function*(){const t=yield Object(r.c)(e,"olm.package");return Object(c.a)(e,t).then(e=>e.reduce((e,t)=>"fulfilled"===t.status&&t.value?e+1:e,0))})))(e)}).then(e=>{console.log("[Extension Catalog Database] Database initialization complete.",e,"items populated to extension catlog object store"),console.timeEnd("[Extension Catalog Database] took")}).catch(e=>{throw console.warn("[Extension Catalog Database] Error encountered",e.toString()),console.timeEnd("[Extension Catalog Database] took"),new Error(e)})}))},9594:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(16),r=n(59),o=n(1947),c=n(6848);const i=(e,t,n)=>{var a;return Object.assign(Object.assign({},e),{[t]:[...null!==(a=e[t])&&void 0!==a?a:[],...null!=n?n:[]]})},s=(e,t,n)=>{if(!n)return e;try{return i(e,t,JSON.parse(n))}catch(e){throw new Error(`Malformed FBC metadata property: "${t}". Expected serialized JSON array, got "${n}".`)}},u=(e,t)=>Object.entries(t).reduce((e,[t,n])=>{if(!n)return e;switch(t){case c.a.description:case c.a.displayName:case c.a.capabilities:return Object.assign({[t]:n},e);case c.a.validSubscription:return s(e,c.c.validSubscription,n);case c.a.legacyInfrastructureFeatures:return((e,t,n)=>{const{infrastructureFeatures:a}=s(e,t,n);return a?Object.assign(Object.assign({},e),{infrastructureFeatures:a.map(e=>o.l[e])}):e})(e,c.c.infrastructureFeatures,n);case c.a.categories:return((e,t,n)=>{if(!n)return e;try{const a=n.split(",").map(e=>e.trim()).filter(e=>e);if(!a.length)throw new Error;return i(e,t,a)}catch(e){throw new Error(`Malformed FBC metadata property: "${t}". Expected comma-separated list, got "${n}".`)}})(e,t,n);case r.d.Disconnected:case r.d.FIPSCompliant:case r.d.ProxyAware:case r.d.CNF:case r.d.CNI:case r.d.CSI:case r.d.TLSProfiles:case r.d.TokenAuthAWS:case r.d.TokenAuthAzure:case r.d.TokenAuthGCP:return"true"===n?i(e,c.c.infrastructureFeatures,[o.l[t]]):e;default:return e}},e),l=(e,t)=>e?Object.keys(e).sort().reduce((t,n)=>{const r=e[n];if(!r)return t;switch(n){case c.a.annotations:return Object.assign(Object.assign({},t),u(t,r));case c.a.description:return Object.assign(Object.assign({},t),{[c.c.longDescription]:r});case c.a.displayName:return Object.assign(Object.assign({},t),{[n]:r});case c.a.provider:return((e,t,n,r)=>Object.assign(Object.assign({},e),{[t]:a.a(n,r,n)}))(t,n,r,"name");case c.a.keywords:return i(t,n,r);default:return t}},null!=t?t:{}):t,d=e=>e.properties.reduce((e,t)=>{switch(t.type){case"olm.csv.metadata":return l(t.value,e);default:return e}},{})},9595:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(83);const r=(e,t)=>{try{e.enqueue(JSON.parse(t))}catch(e){console.warn(`Error parsing JSON line: ${e}\n${t}`)}},o=()=>new TransformStream({start(){this.buffer=""},transform(e,t){this.buffer+=e;const n=this.buffer.split("\n").map(e=>null==e?void 0:e.trim());this.buffer=this.buffer.endsWith("\n")?"":n.pop().trim(),n.forEach(e=>{e&&r(t,e)})},flush(e){this.buffer&&r(e,this.buffer)}}),c=(e,t)=>Object(a.consoleFetch)(e,t).then(t=>{if(!t.ok)throw new Error(`Failed to fetch ${e}: ${t.statusText}`);return t.body.pipeThrough(new TextDecoderStream).pipeThrough(o()).getReader()})},9596:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(1947),r=n(474),o=n(8242),c=n(9597),i=n(6356),s=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function c(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}s((a=a.apply(e,t||[])).next())}))};const u=(e,t)=>Promise.allSettled(t.map(t=>((e,{id:t,icon:n,name:u,catalog:l})=>s(void 0,void 0,void 0,(function*(){const s=yield Object(c.a)(e,t),d=yield Object(o.b)(e,t),f=Object.assign({catalog:l,id:t,icon:n,name:u,source:a.a[l]||r.i.Custom,channels:Object.assign({},s)},d);return yield Object(i.e)(e,"extension-catalog",f),f})))(e,t).catch(e=>(console.warn("[Extension Catalog Database] Error encountered while creating extension catalog item for",t.name,e.toString()),null))))},9597:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(6356),r=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function c(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}s((a=a.apply(e,t||[])).next())}))};const o=(e,t)=>r(void 0,void 0,void 0,(function*(){const n=yield Object(a.b)(e,"olm.channel","package",t).catch(e=>(console.warn(e),[]));return(e=>e.reduce((e,t)=>{const n=t.entries.map(({name:e})=>e);return Object.assign(Object.assign({},e),{[t.name]:n})},{}))(null!=n?n:[])}))},9598:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(6848);const r=e=>e.schema===a.b.bundle}}]);
//# sourceMappingURL=useExtensionCatalogDatabaseContextValues-chunk-9ef208eea2c0940042eb.min.js.map