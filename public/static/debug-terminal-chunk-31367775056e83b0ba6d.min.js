(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{5540:function(e,t,n){"use strict";n.r(t),n.d(t,"DebugTerminal",(function(){return P})),n.d(t,"DebugTerminalPage",(function(){return j}));var a=n(640),o=n(0),i=n(137),r=n(14),l=n(80),d=n(7),s=n(5),c=n(8),u=n(1410),m=n(10),b=n(108),p=n(99),v=n(987),f=n(252),g=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function r(e){try{d(a.next(e))}catch(e){i(e)}}function l(e){try{d(a.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}d((a=a.apply(e,t||[])).next())}))};const h=(e,t,n)=>{var o;const i=a.a(t);var r;return delete i.metadata.resourceVersion,delete i.metadata.uid,delete i.metadata.managedFields,delete i.metadata.name,delete i.metadata.ownerReferences,delete i.metadata.labels,i.metadata.annotations=(r=i.metadata.annotations,Object.keys(r).filter(e=>["resources.workload.openshift.io/","target.workload.openshift.io/"].find(t=>e.startsWith(t))).reduce((e,t)=>Object.assign(e,{[t]:r[t]}),{})),i.metadata.annotations["debug.openshift.io/source-container"]=n,i.metadata.annotations["debug.openshift.io/source-resource"]="/v1, Resource=pods/"+(null===(o=null==t?void 0:t.metadata)||void 0===o?void 0:o.name),i.metadata.generateName=e,i.spec.restartPolicy="Never",i.spec.containers.forEach(e=>{e.command=Object(f.e)(t)?["cmd"]:["/bin/sh"],e.stdin=!0,e.stdinOnce=!0,e.tty=!0,null==e||delete e.args,null==e||delete e.readinessProbe,null==e||delete e.livenessProbe}),delete i.spec.host,delete i.spec.nodeName,delete i.status,i},E=({error:e,description:t})=>o.createElement("div",{className:"co-m-pane__body"},o.createElement(l.a,{variant:"danger",isInline:!0,title:e},o.createElement("p",null,t))),w=({debugPod:e,initialContainer:t})=>{var n,a,i,r,c;const{t:m}=Object(d.useTranslation)(),b=o.createElement(l.a,{variant:"info",isInline:!0,title:m("public~This temporary pod has a modified entrypoint command to debug a failing container. The pod will be deleted when the terminal window is closed.")});switch(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.phase){case"Failed":case"Unknown":return o.createElement(E,{error:o.createElement(o.Fragment,null,m("public~The debug pod failed.")),description:(null===(c=null===(r=null===(i=null===(a=e.status.containerStatuses)||void 0===a?void 0:a[0])||void 0===i?void 0:i.state)||void 0===r?void 0:r.terminated)||void 0===c?void 0:c.message)||e.status.message});case"Running":return o.createElement(u.PodExecLoader,{obj:e,initialContainer:t,infoMessage:b});case"Pending":return o.createElement(s.S,null,e.status.phase);default:return o.createElement(s.S,null)}},P=({podData:e,containerName:t})=>{var n,a;const[i,r]=o.useState(""),[l,u]=o.useState(""),{t:p}=Object(d.useTranslation)(),v=null==e?void 0:e.metadata.namespace,f=t||(null==e?void 0:e.spec.containers[0].name),P=(null===(a=null===(n=null==e?void 0:e.metadata)||void 0===n?void 0:n.name)||void 0===a?void 0:a.replace(/\./g,"-"))+"-debug-",j=o.useMemo(()=>h(P,e,f),[P,f]);o.useEffect(()=>{const e=e=>g(void 0,void 0,void 0,(function*(){try{yield Object(c.mb)(m.PodModel,e,v)}catch(e){console.warn("Could not delete container terminal debug pod.",e)}}));let t;const n=n=>{n.preventDefault(),e(t.metadata.name)};return g(void 0,void 0,void 0,(function*(){var e;try{t=yield Object(c.jb)(m.PodModel,j),u(null===(e=null==t?void 0:t.metadata)||void 0===e?void 0:e.name)}catch(e){r(e.message)}})),window.addEventListener("beforeunload",n),()=>{t&&e(t.metadata.name),window.removeEventListener("beforeunload",n)}},[P,v,j]);const[O,y,T]=Object(b.a)(l?{isList:!1,kind:"Pod",name:l,namespace:v}:{});if(i)return o.createElement(E,{error:i});if(l){if(T)return o.createElement(E,{error:T.message||p("public~The debug pod failed.")});if(y)return o.createElement(w,{initialContainer:t,debugPod:O})}return o.createElement(s.S,null)},j=()=>{const{t:e}=Object(d.useTranslation)(),t=Object(r.useParams)(),{podName:n,ns:a,name:l}=t,{pathname:c}=Object(r.useLocation)(),[u,m,f]=Object(b.a)({isList:!1,kind:"Pod",name:n,namespace:a});return o.createElement("div",null,o.createElement(i.b,null,o.createElement("title",null,e("public~Debug {{name}}",{name:l}))),o.createElement(s.Z,{detail:!0,title:e("public~Debug {{name}}",{name:l}),kind:"Pod",obj:{data:u},breadcrumbs:[{name:e("public~Pods"),path:Object(v.b)(t,"pods")},{name:n,path:Object(p.resourcePath)("Pod",n,a)},{name:e("public~Container details"),path:`${Object(p.resourcePath)("Pod",n,a)}/containers/${l}`},{name:e("public~Debug container"),path:c}]}),m&&!f&&o.createElement(P,{podData:u,containerName:l}),f&&o.createElement(s.S,null,f),!m&&o.createElement(s.S,null))};j.displayName="DebugTerminalPage"}}]);
//# sourceMappingURL=debug-terminal-chunk-31367775056e83b0ba6d.min.js.map