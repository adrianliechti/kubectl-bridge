(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{11861:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var i=a(0),r=a(22),n=a(7),l=a(10),c=a(15),s=a(614),o=a(1941),m=a(8402),u=a(8403),d=a(5);const p=({dirty:e,errors:t,existingRoute:a,handleCancel:p,handleSubmit:h,heading:f,isSubmitting:g,services:b,setStatus:v,status:E,submitLabel:y,validateForm:k,values:C})=>{const{t:w}=Object(n.useTranslation)(),{editorType:S,formData:N}=C,F=i.createElement(m.a,{services:b,existingRoute:a}),D=i.createElement(c.C,{name:"yamlData",model:l.RouteModel,onSave:h,showSamples:!0});return i.useEffect(()=>{v({submitError:null}),C.editorType===s.b.Form&&setTimeout(()=>k(),0)},[v,C.editorType,k]),i.createElement(i.Fragment,null,i.createElement(d.Z,{title:f,helpText:w("public~Routing is a way to make your application publicly visible.")}),i.createElement(c.P,{onSubmit:h},i.createElement(c.Q,{flexLayout:!0,className:"co-m-pane__body--no-top-margin"},i.createElement(c.fc,{name:"editorType",formContext:{name:"formData",editor:F,sanitizeTo:e=>Object(u.b)(b,e)},yamlContext:{name:"yamlData",editor:D,sanitizeTo:()=>Object(o.b)(Object(u.a)(N,a),"yamlData",{skipInvalid:!0})},lastViewUserSettingKey:"console.routeForm.editor.lastView",noMargin:!0})),i.createElement(c.R,{handleCancel:p,errorMessage:null==E?void 0:E.submitError,successMessage:null==E?void 0:E.submitSuccess,isSubmitting:g,submitLabel:y,disableSubmit:(S===s.b.YAML?!e:!e||!r.a(t))||g,sticky:!0})))}},4492:function(e,t,a){"use strict";a.r(t),a.d(t,"RoutePage",(function(){return C}));var i=a(0),r=a(55),n=a(14),l=a(137),c=a(13),s=a(77),o=a(765),m=a(5),u=a(108),d=a(10),p=a(8),h=a(614),f=a(1941),g=a(2258),b=a(11861),v=a(7),E=a(8403),y=function(e,t,a,i){return new(a||(a=Promise))((function(r,n){function l(e){try{s(i.next(e))}catch(e){n(e)}}function c(e){try{s(i.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,c)}s((i=i.apply(e,t||[])).next())}))};const k=g.a.get(Object(p.Hb)(d.RouteModel)).get("default"),C=()=>{const{t:e}=Object(v.useTranslation)(),t=Object(n.useNavigate)(),{ns:a,name:p}=Object(n.useParams)(),g=!!p,C=e(g?"public~Edit Route":"public~Create Route"),w=e(g?"public~Save":"public~Create"),[S,N,F]=Object(u.a)({kind:d.RouteModel.kind,name:p,namespace:a}),[D,T,O]=Object(u.a)({kind:d.ServiceModel.kind,namespace:a,isList:!0}),_=N&&T,P=Object(c.ic)({group:d.RouteModel.apiGroup,resource:"routes/custom-host",verb:"update",name:p,namespace:a}),j=i.useMemo(()=>({editorType:h.b.Form,yamlData:g?Object(f.b)(S,"yamlData",{skipInvalid:!0}):k,formData:g?Object(E.b)(D,S):{}}),[g,S,D]),A=()=>t(-1);return g&&_&&!S?i.createElement(o.ErrorPage404,null):i.createElement(i.Fragment,null,i.createElement(l.b,null,i.createElement("title",null,C)),i.createElement(m.wb,{loaded:_,loadError:F||O,data:j},i.createElement(r.b,{initialValues:j,onSubmit:(i,r)=>y(void 0,void 0,void 0,(function*(){const n=i.editorType===h.b.Form?Object(E.a)(i.formData,g&&S):Object(f.c)(i.yamlData);if((null==n?void 0:n.metadata)&&!n.metadata.namespace&&(n.metadata.namespace=a),!P&&g&&n.spec.host!==S.spec.host)return r.setStatus({submitSuccess:"",submitError:e("public~Insufficient permissions to update host.")}),null;let l;try{l=g?yield Object(s.r)({model:d.RouteModel,data:n,name:p}):yield Object(s.g)({model:d.RouteModel,data:n}),t(`/k8s/ns/${l.metadata.namespace}/routes/${l.metadata.name}`)}catch(t){r.setStatus({submitSuccess:"",submitError:(null==t?void 0:t.message)||e("public~Unknown error submitting")})}return l})),validationSchema:E.c,enableReinitialize:!0},e=>i.createElement(b.a,Object.assign({},e,{heading:C,handleCancel:A,submitLabel:w,services:D,existingRoute:p&&S})))))}},8402:function(e,t,a){"use strict";a.d(t,"b",(function(){return N})),a.d(t,"a",(function(){return O}));var i=a(16),r=a(141),n=a(117),l=a(840),c=a(57),s=a(461),o=a(1451),m=a(50),u=a(22),d=a(160),p=a(2292),h=a(0),f=a(230),g=a(19),b=a(80),v=a(407),E=a(408),y=a(55),k=a(7),C=a(5),w=a(53),S=a(282);const N="#unnamed",F=e=>{if(!e)return{};return i.a(e,"spec.ports",[]).reduce((e,{name:t=N,port:a,targetPort:i,protocol:r})=>(e[t]=h.createElement(h.Fragment,null,a," â†’ ",i," (",r,")"),e),{})},D=e=>h.createElement(S.a,Object.assign({loader:()=>Promise.resolve().then(a.bind(null,2223)).then(e=>e.DroppableFileInput)},e));class T extends h.Component{constructor(){super(...arguments),this.state={name:"",hostname:"",path:"",service:null,weight:100,targetPort:"",termination:"",insecureEdgeTerminationPolicy:"",certificate:"",key:"",caCertificate:"",destinationCACertificate:"",secure:!1,namespace:Object(w.c)(),labels:{},portOptions:{},alternateBackends:[]},this.handleChange=e=>{const{name:t,value:a}=e.currentTarget;this.setState({[t]:a}),this.props.formik.setFieldValue("formData."+t,a)},this.handleWeightChange=e=>{const t=r.a(e.currentTarget.value);this.setState({weight:t}),this.props.formik.setFieldValue("formData.weight",t)},this.changeService=e=>{const t=n.a(this.props.services,{metadata:{name:e}}),a=F(t);this.setState({service:t,portOptions:a,targetPort:""}),this.props.formik.setFieldValue("formData.service",t),this.props.formik.setFieldValue("formData.portOptions",a),this.props.formik.setFieldValue("formData.targetPort","")},this.changeTargetPort=e=>{this.setState({targetPort:e}),this.props.formik.setFieldValue("formData.targetPort",e)},this.toggleSection=e=>{const{name:t,checked:a}=e.currentTarget;this.setState({[t]:a}),this.props.formik.setFieldValue("formData."+t,a)},this.changeTermination=e=>{const t={termination:e,insecureEdgeTerminationPolicy:""};switch(this.props.formik.setFieldValue("formData.termination",e),this.props.formik.setFieldValue("formData.insecureEdgeTerminationPolicy",""),e){case"edge":t.destinationCACertificate="",this.props.formik.setFieldValue("formData.destinationCACertificate","");break;case"passthrough":Object.assign(t,{certificate:"",key:"",caCertificate:"",destinationCACertificate:""}),this.props.formik.setFieldValue("formData.certificate",""),this.props.formik.setFieldValue("formData.key",""),this.props.formik.setFieldValue("formData.caCertificate",""),this.props.formik.setFieldValue("formData.destinationCACertificate","")}this.setState(t)},this.changeInsecureTraffic=e=>{this.setState({insecureEdgeTerminationPolicy:e}),this.props.formik.setFieldValue("formData.insecureEdgeTerminationPolicy",e)},this.onCertificateChange=e=>{this.setState({certificate:e}),this.props.formik.setFieldValue("formData.certificate",e)},this.onPrivateKeyChange=e=>{this.setState({key:e}),this.props.formik.setFieldValue("formData.key",e)},this.onCaCertificateChange=e=>{this.setState({caCertificate:e}),this.props.formik.setFieldValue("formData.caCertificate",e)},this.onDestinationCACertificateChange=e=>{this.setState({destinationCACertificate:e}),this.props.formik.setFieldValue("formData.destinationCACertificate",e)},this.addAltServiceEntry=()=>{this.setState(({alternateBackends:e})=>{const t=[...e,{name:null,weight:100,key:l.a("alternate-backend-")}];return this.props.formik.setFieldValue("formData.alternateBackends",t),{alternateBackends:t}})},this.onDataChanged=(e,t)=>{this.setState(({alternateBackends:a})=>{const i=[...a],r={key:i[t].key,weight:e.weight,name:e.name};return i[t]=r,this.props.formik.setFieldValue("formData.alternateBackends",i),{alternateBackends:i}})},this.autocompleteFilter=(e,t)=>{var a;return f(e,null===(a=null==t?void 0:t.props)||void 0===a?void 0:a.name)}}componentDidMount(){var e;const{formik:t}=this.props,a=F(null===(e=t.values.formData)||void 0===e?void 0:e.service);this.setState(e=>Object.assign(Object.assign(Object.assign({},e),t.values.formData),{portOptions:a}))}removeAltServiceEntry(e){this.setState(({alternateBackends:t})=>{const a=[...t];return a.splice(e,1),this.props.formik.setFieldValue("formData.alternateBackends",a),{alternateBackends:a}},()=>{this.state.alternateBackends.length<1&&(this.setState({weight:100}),this.props.formik.setFieldValue("formData.weight",100))})}render(){var e;const{t:t,services:a,existingRoute:i}=this.props,{service:r,portOptions:n,targetPort:l,termination:f,alternateBackends:y,insecureEdgeTerminationPolicy:k}=this.state,w={};c.a(s.a(a,"metadata.name"),({metadata:{name:e}})=>w[e]=h.createElement(C.jb,{kind:"Service",name:e}));const S=new Set;r&&S.add(r.metadata.name),c.a(y,({name:e})=>S.add(e));const F=o.a(w,(e,t)=>!S.has(t)),T=m.a(y,(e,a)=>h.createElement("div",{className:"co-add-remove-form__entry",key:e.key},!u.a(y)&&h.createElement("div",{className:"co-add-remove-form__link--remove-entry"},h.createElement(g.a,{type:"button",onClick:()=>this.removeAltServiceEntry(a),variant:"link",isInline:!0},h.createElement(E.a,{className:"co-icon-space-r"}),t("public~Remove alternate Service"))),h.createElement(_,{index:a,name:e.name,weight:e.weight,onChange:this.onDataChanged,serviceOptions:w,availableServiceOptions:F})));return h.createElement("div",{className:"co-m-pane__form"},h.createElement("div",{className:"form-group co-create-route__name"},h.createElement("label",{className:"co-required",htmlFor:"name"},t("public~Name")),h.createElement("input",{className:"pf-v5-c-form-control",type:"text",onChange:this.handleChange,value:this.state.name,disabled:!!i,placeholder:"my-route",id:"name",name:"name","aria-describedby":"name-help",required:!0}),h.createElement("div",{className:"help-block",id:"name-help"},h.createElement("p",null,t("public~A unique name for the Route within the project.")))),h.createElement("div",{className:"form-group co-create-route__hostname"},h.createElement("label",{htmlFor:"hostname"},t("public~Hostname")),h.createElement("input",{className:"pf-v5-c-form-control",type:"text",onChange:this.handleChange,value:this.state.hostname,placeholder:"www.example.com",id:"hostname",name:"hostname","aria-describedby":"hostname-help"}),h.createElement("div",{className:"help-block",id:"hostname-help"},h.createElement("p",null,t("public~Public hostname for the Route. If not specified, a hostname is generated.")))),h.createElement("div",{className:"form-group co-create-route__path"},h.createElement("label",{htmlFor:"path"},t("public~Path")),h.createElement("input",{className:"pf-v5-c-form-control",type:"text",onChange:this.handleChange,value:null!==(e=this.state.path)&&void 0!==e?e:"",placeholder:"/",id:"path",name:"path","aria-describedby":"path-help"}),h.createElement("div",{className:"help-block",id:"path-help"},h.createElement("p",null,t("public~Path that the router watches to route traffic to the service.")))),h.createElement("div",{className:"form-group co-create-route__service"},h.createElement("label",{className:"co-required",htmlFor:"service"},t("public~Service")),u.a(w)&&h.createElement(b.a,{isInline:!0,className:"co-alert co-create-route__alert",variant:"info",title:"No services"},t("public~There are no Services in your project to expose with a Route.")),!u.a(w)&&h.createElement(C.t,{autocompleteFilter:this.autocompleteFilter,items:F,title:r?w[r.metadata.name]:t("public~Select a service"),dropDownClassName:"dropdown--full-width",id:"service",onChange:this.changeService,describedBy:"service-help"}),h.createElement("div",{className:"help-block",id:"service-help"},h.createElement("p",null,t("public~Service to route to.")))),T.length>0&&h.createElement(h.Fragment,null,h.createElement("div",{className:"form-group co-create-route__weight"},h.createElement("label",{htmlFor:"weight"},t("public~Weight")),h.createElement("input",{className:"pf-v5-c-form-control co-create-route__weight-label",type:"number",onChange:this.handleWeightChange,value:this.state.weight,id:"weight","aria-describedby":"weight-help"}),h.createElement("div",{className:"help-block",id:"weight-help"},h.createElement("p",null,t("public~A number between 0 and 255 that depicts relative weight compared with other targets.")))),T),T.length<3&&T.length+1<d.a(w).length&&r&&h.createElement(g.a,{className:"pf-m-link--align-left co-create-route__add-service-btn",onClick:this.addAltServiceEntry,type:"button",variant:"link",isInline:!0},h.createElement(v.a,{className:"co-icon-space-r"}),t("public~Add alternate Service")),h.createElement("div",{className:"form-group co-create-route__target-port"},h.createElement("label",{className:"co-required",htmlFor:"target-port"},t("public~Target port")),u.a(n)&&h.createElement("p",null,t("public~Select a Service above")),!u.a(n)&&h.createElement(C.t,{items:n,title:t("public~Select target port"),selectedKey:p.a(l)?N:l,dropDownClassName:"dropdown--full-width",id:"target-port",onChange:this.changeTargetPort,describedBy:"target-port-help"}),h.createElement("div",{className:"help-block",id:"target-port-help"},h.createElement("p",null,t("public~Target port for traffic.")))),h.createElement("div",{className:"form-group co-create-route__security"},h.createElement("label",{className:"control-label"},t("public~Security")),h.createElement("div",{className:"checkbox"},h.createElement("label",null,h.createElement("input",{type:"checkbox",onChange:this.toggleSection,checked:this.state.secure,id:"secure",name:"secure","aria-describedby":"secure-help"}),t("public~Secure Route")),h.createElement("div",{className:"help-block",id:"secure-help"},h.createElement("p",null,t("public~Routes can be secured using several TLS termination types for serving certificates.")))),this.state.secure&&h.createElement("div",{className:"co-create-route__security"},h.createElement("div",{className:"form-group co-create-route__tls-termination"},h.createElement("label",{className:"co-required",htmlFor:"tls-termination"},t("public~TLS termination")),h.createElement(C.t,{items:{edge:"Edge",passthrough:"Passthrough",reencrypt:"Re-encrypt"},title:t("public~Select termination type"),dropDownClassName:"dropdown--full-width",id:"tls-termination",onChange:this.changeTermination,selectedKey:f})),h.createElement("div",{className:"form-group co-create-route__insecure-traffic"},h.createElement("label",{htmlFor:"insecure-traffic"},t("public~Insecure traffic")),h.createElement(C.t,{items:"passthrough"===f?{None:"None",Redirect:"Redirect"}:{None:"None",Allow:"Allow",Redirect:"Redirect"},title:t("public~Select insecure traffic type"),dropDownClassName:"dropdown--full-width",id:"insecure-traffic",onChange:this.changeInsecureTraffic,describedBy:"insecure-traffic-help",selectedKey:k}),h.createElement("div",{className:"help-block",id:"insecure-traffic-help"},h.createElement("p",null,t("public~Policy for traffic on insecure schemes like HTTP.")))),f&&"passthrough"!==f&&h.createElement(h.Fragment,null,h.createElement("h2",{className:"h3"},t("public~Certificates")),h.createElement("div",{className:"help-block"},h.createElement("p",null,t("public~TLS certificates for edge and re-encrypt termination. If not specified, the router&apos;s default certificate is used."))),h.createElement("div",{className:"form-group co-create-route__certificate"},h.createElement(D,{onChange:this.onCertificateChange,inputFileData:this.state.certificate,id:"certificate",label:t("public~Certificate"),inputFieldHelpText:t("public~The PEM format certificate. Upload file by dragging & dropping, selecting it, or pasting from the clipboard.")})),h.createElement("div",{className:"form-group co-create-route__private-key"},h.createElement(D,{onChange:this.onPrivateKeyChange,inputFileData:this.state.key,id:"private-key",label:t("public~Private key"),inputFieldHelpText:t("public~The PEM format key. Upload file by dragging & dropping, selecting it, or pasting from the clipboard.")})),h.createElement("div",{className:"form-group co-create-route__caCertificate"},h.createElement(D,{onChange:this.onCaCertificateChange,inputFileData:this.state.caCertificate,id:"ca-certificate",label:t("public~CA certificate"),inputFieldHelpText:t("public~The PEM format CA certificate chain. Upload file by dragging & dropping, selecting it, or pasting from the clipboard.")})),"reencrypt"===f&&h.createElement("div",{className:"form-group co-create-route__destinationCaCertificate"},h.createElement(D,{onChange:this.onDestinationCACertificateChange,inputFileData:this.state.destinationCACertificate,id:"destination-ca-certificate",label:t("public~Destination CA certificate")}))))))}}const O=Object(k.withTranslation)()(Object(y.c)(T)),_=e=>{const{t:t}=Object(k.useTranslation)(),[a,i]=h.useState(e.weight),[n,l]=h.useState(e.name),{serviceOptions:c,availableServiceOptions:s,index:o,onChange:m}=e;return h.useEffect(()=>{m({name:n,weight:a},o)},[n,a,o,m]),h.createElement(h.Fragment,null,h.createElement("div",{className:"form-group"},h.createElement("label",{htmlFor:o+"-alt-service"},t("public~Alternate Service target")),h.createElement(C.t,{items:s,title:n?c[n]:t("public~Select a service"),dropDownClassName:"dropdown--full-width",id:o+"-alt-service",onChange:e=>{l(e)},describedBy:o+"-alt-service-help"}),h.createElement("div",{className:"help-block",id:o+"-alt-service-help"},h.createElement("p",null,t("public~Alternate Service to route to.")))),h.createElement("div",{className:"form-group"},h.createElement("label",{htmlFor:o+"-weight"},t("public~Alternate Service weight")),h.createElement("input",{className:"pf-v5-c-form-control co-create-route__weight-label",id:o+"-weight",type:"number",onChange:e=>{i(r.a(e.currentTarget.value))},value:a,"aria-describedby":o+"-alt-weight-help"}),h.createElement("div",{className:"help-block",id:o+"-alt-weight-help"},h.createElement("p",null,t("public~A number between 0 and 255 that depicts relative weight compared with other targets.")))))}},8403:function(e,t,a){"use strict";a.d(t,"c",(function(){return u})),a.d(t,"b",(function(){return d})),a.d(t,"a",(function(){return p}));var i=a(840),r=a(116),n=a(16),l=a(1557),c=a(689),s=a(614),o=a(53),m=a(8402);const u=c.object({editorType:c.string(),formData:c.object().when("editorType",{is:s.b.Form,then:c.object({name:c.string().required(),service:c.string().required(),targetPort:c.string().required(),termination:c.string().when("formData.secure",{is:!0,then:c.string().required()})})})}),d=(e,t)=>{var a,r,n,l,c,s,m,u;if(!t)return null;const{metadata:d,spec:p}=t;return{name:null==d?void 0:d.name,hostname:null==p?void 0:p.host,path:null==p?void 0:p.path,service:null==e?void 0:e.find(e=>{var t;return e.metadata.name===(null===(t=null==p?void 0:p.to)||void 0===t?void 0:t.name)}),weight:null===(a=null==p?void 0:p.to)||void 0===a?void 0:a.weight,targetPort:null===(r=null==p?void 0:p.port)||void 0===r?void 0:r.targetPort,termination:null===(n=null==p?void 0:p.tls)||void 0===n?void 0:n.termination,insecureEdgeTerminationPolicy:null===(l=null==p?void 0:p.tls)||void 0===l?void 0:l.insecureEdgeTerminationPolicy,certificate:null===(c=null==p?void 0:p.tls)||void 0===c?void 0:c.certificate,key:null===(s=null==p?void 0:p.tls)||void 0===s?void 0:s.key,caCertificate:null===(m=null==p?void 0:p.tls)||void 0===m?void 0:m.caCertificate,destinationCACertificate:null===(u=null==p?void 0:p.tls)||void 0===u?void 0:u.destinationCACertificate,secure:!!(null==p?void 0:p.tls),namespace:(null==d?void 0:d.namespace)||Object(o.c)(),labels:null==d?void 0:d.labels,alternateBackends:Array.isArray(null==p?void 0:p.alternateBackends)?p.alternateBackends.map(e=>({name:e.name,weight:e.weight,key:i.a("alternate-backend-")})):[]}},p=(e,t)=>{const{name:a,hostname:i,path:c,service:s,weight:u,targetPort:d,namespace:p,alternateBackends:h}=e,f=(e=>{const{termination:t,insecureEdgeTerminationPolicy:a,certificate:i,key:r,caCertificate:n,destinationCACertificate:l,secure:c}=e;return c?{termination:t,insecureEdgeTerminationPolicy:a,certificate:i,key:r,caCertificate:n,destinationCACertificate:l}:null})(e),g=n.a(s,"metadata.name"),b=l.a(n.a(s,"metadata.labels"),n.a(t,"metadata.labels")),v=d===m.b?n.a(s,"spec.ports[0].targetPort")||n.a(s,"spec.ports[0].port"):d,E=(e=>r.a(e,"name").map(e=>({weight:e.weight,kind:"Service",name:e.name})))(h),y=Object.assign(Object.assign({},t||{}),{kind:"Route",apiVersion:"route.openshift.io/v1",metadata:Object.assign(Object.assign({},n.a(t,"metadata",{})),{name:a,namespace:p||Object(o.c)(),labels:b}),spec:Object.assign(Object.assign({},n.a(t,"spec",{})),{to:{kind:"Service",name:g,weight:u},tls:f,host:i,path:c,port:{targetPort:v}})});return y.spec.alternateBackends=E,y}}}]);
//# sourceMappingURL=edit-route-chunk-3c4dbc62df44d3c2b9b1.min.js.map