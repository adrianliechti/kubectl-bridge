(window.webpackJsonp=window.webpackJsonp||[]).push([[297],{5657:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return i}));const o=e=>"Topology/ComponentFactory"===e.type,r=e=>"Topology/DataModelFactory"===e.type,a=e=>"Topology/CreateConnector"===e.type,s=e=>"Topology/DisplayFilters"===e.type,i=e=>"Topology/Decorator"===e.type},5662:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l}));var o=n(0),r=n(5619),a=n(5589),s=n(5647),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function s(e){try{c(o.next(e))}catch(e){a(e)}}function i(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((o=o.apply(e,t||[])).next())}))};class c{constructor(e){this.extensions={},this.namespace=void 0,this.model={nodes:[],edges:[]},this.loaded=!1,this.loadError=void 0,this.extensionsLoaded=!1,this.watchedResources={},this.updateWatchedResources=()=>{const e=Object.keys(this.extensions);this.watchedResources=e.reduce((e,t)=>{if(this.extensions[t].resources){const n=this.extensions[t].resources(this.namespace);Object.keys(n).forEach(t=>{e[t]||(e[t]=n[t])})}return e},Object(s.d)(this.namespace))},this.updateExtension=(e,t)=>{this.extensions[e]=Object.assign(Object.assign({},this.extensions[e]||{}),t),this.updateExtensionsLoaded(),this.updateWatchedResources()},this.getWorkloadResources=e=>{const t=this.watchedResources,n=Object.keys(t).reduce((e,n)=>(e[n]=t[n].kind,e),{});return Object(s.i)(e,n,this.workloadKeys)},this.getExtensionModels=e=>i(this,void 0,void 0,(function*(){const t={nodes:[],edges:[]},n=this.dataModelGetters;if(!(null==n?void 0:n.length))return Promise.resolve(t);const o=this.dataModelDepicters,r=this.getWorkloadResources(e),a=n.map(t=>{try{return t(this.namespace,e,r)}catch(e){return console.error("Unable to add some resources to topology",e),null}});return yield Promise.all(a).then(e=>{e.forEach(e=>{if(e)try{Object(s.b)(e,t,o)}catch(e){console.error("Unable to add some resources to topology",e)}})}),Promise.resolve(t)})),this.reconcileModel=(e,t)=>{this.dataModelReconcilers.forEach(n=>{try{n(e,t)}catch(e){console.error("Unable to reconcile some resources in topology",e)}})},this.namespace=e,Object(r.p)(this,{namespace:r.q,model:r.q.ref,loaded:r.q,loadError:r.q,extensionsLoaded:r.q,watchedResources:r.q.ref,isEmptyModel:r.i})}updateExtensionsLoaded(){const e=Object.keys(this.extensions),t=this.extensionsLoaded;this.extensionsLoaded=e.length>1&&e.every(e=>!!this.extensions[e].dataModelGetter&&!!this.extensions[e].dataModelDepicter&&!!this.extensions[e].dataModelReconciler),!t&&this.extensionsLoaded&&this.onExtensionsLoaded&&this.onExtensionsLoaded(this)}getExtensions(){return this.extensions}getExtension(e){return this.extensions[e]}get workloadKeys(){const e=[...a.a];return Object.keys(this.extensions).forEach(t=>{this.extensions[t].workloadKeys&&this.extensions[t].workloadKeys.forEach(t=>{e.includes(t)||e.push(t)})}),e}get prioritizedKeys(){return Object.keys(this.extensions).sort((e,t)=>this.extensions[e].priority-this.extensions[t].priority)}get dataModelGetters(){return this.prioritizedKeys.reduce((e,t)=>(this.extensions[t].dataModelGetter&&e.push(this.extensions[t].dataModelGetter),e),[])}get dataModelDepicters(){return this.prioritizedKeys.reduce((e,t)=>(this.extensions[t].dataModelDepicter&&e.push(this.extensions[t].dataModelDepicter),e),[])}get dataModelReconcilers(){return this.prioritizedKeys.reduce((e,t)=>(this.extensions[t].dataModelReconciler&&e.push(this.extensions[t].dataModelReconciler),e),[])}get isEmptyModel(){var e,t,n;return 0===(null!==(n=null===(t=null===(e=this.model)||void 0===e?void 0:e.nodes)||void 0===t?void 0:t.length)&&void 0!==n?n:0)}}const l=Object(o.createContext)(null)},5704:function(e,t,n){"use strict";var o=n(0),r=n(7),a=n(13),s=n(5),i=n(69),c=n(15),l=n(5710),d=n(5647),u=n(5720),p=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};t.a=e=>{var{namespace:t}=e,n=p(e,["namespace"]);const{t:m}=Object(r.useTranslation)(),h=Object(i.z)(u.a),b=Object(i.z)(a.Zb),f=o.useMemo(()=>Object(l.b)(b),[b]),g=o.useMemo(()=>{let e=Object(d.d)(t);return[...h,...f].forEach(n=>{var o,r;const a=null===(r=(o=n.properties).resources)||void 0===r?void 0:r.call(o,t);a&&(e=Object.assign(Object.assign({},a),e))}),Object.keys(e).map(t=>Object.assign(Object.assign({},e[t]),{prop:t}))},[f,h,t]);return o.createElement(s.C,{resources:g},o.createElement(c.Nb,Object.assign({},n,{placeholder:m("topology~Select an application"),dataSelector:["metadata","labels","app.kubernetes.io/part-of"]})))}},5710:function(e,t,n){"use strict";n.d(t,"b",(function(){return u}));var o=n(0),r=n(13),a=n(8),s=n(69),i=n(5657),c=n(5714),l=n(5662),d=n(5715);const u=e=>e.map(e=>Object.assign(Object.assign({},e),{properties:Object.assign(Object.assign({},e.properties),{resources:t=>Object.entries(e.properties.resources||{}).reduce((n,[o,r])=>{const s=((e,t,n,o,r={})=>{if(!o)return Object.assign({namespace:e},r);if(o.version){const t=Object(a.Fb)(o);return Object.assign({namespace:e,kind:t},r)}const s=Object(a.wb)(o.group,o.kind);if(!s)return console.warn(`Plugin "${t.pluginID}": Could not find model (CRD) for group "${o.group}" and kind "${o.kind}" to determinate version. Please add a required flag to the extension to suppress this warning. The resource "${n}" will not be loaded and ignored in the topology view for now:`,t,n,o,r),null;const i=Object(a.Hb)(s);return Object.assign({namespace:e,kind:i},r)})(t,e,o,null==r?void 0:r.model,null==r?void 0:r.opts);return s&&(n[o]=s),n},{})})}));t.a=({namespace:e,children:t})=>{const[n,a]=o.useState(new l.a(e));o.useEffect(()=>{a(new l.a(e))},[e]);const p=Object(s.z)(i.c),m=Object(s.z)(r.Zb),h=o.useMemo(()=>u(m),[m]);return o.createElement(l.b.Provider,{value:n},e&&o.createElement(o.Fragment,null,[...h,...p].map(e=>o.createElement(c.a,{key:e.properties.id,dataModelFactory:e.properties}))),e&&o.createElement(d.a,null),t)}},5714:function(e,t,n){"use strict";var o=n(0),r=n(15),a=n(5662);t.a=({dataModelFactory:e})=>{const t=o.useContext(a.b),{id:n,priority:s,resources:i}=e,c=Object(r.De)(e.workloadKeys),l=o.useRef({priority:s,workloadKeys:c,resources:i});return o.useEffect(()=>{if(!t.getExtension(n)){l.current={priority:s,workloadKeys:c,resources:i},t.updateExtension(n,l.current);const{getDataModel:o,isResourceDepicted:r,getDataModelReconciler:a}=e;o?o().then(e=>{l.current.dataModelGetter=e,t.updateExtension(n,l.current)}).catch(()=>{l.current.dataModelGetter=()=>Promise.resolve({}),t.updateExtension(n,l.current)}):(l.current.dataModelGetter=()=>Promise.resolve({}),t.updateExtension(n,l.current)),r?r().then(e=>{l.current.dataModelDepicter=e,t.updateExtension(n,l.current)}).catch(()=>{l.current.dataModelDepicter=()=>!1,t.updateExtension(n,l.current)}):(l.current.dataModelDepicter=()=>!1,t.updateExtension(n,l.current)),a?a().then(e=>{l.current.dataModelReconciler=e,t.updateExtension(n,l.current)}).catch(()=>{l.current.dataModelReconciler=()=>{},t.updateExtension(n,l.current)}):(l.current.dataModelReconciler=()=>{},t.updateExtension(n,l.current))}},[t,e,n,s,i,c]),null}},5715:function(e,t,n){"use strict";var o=n(0),r=n(5585),a=n(22),s=n(108),i=n(15),c=n(5662),l=n(5716),d=n(5718);t.a=Object(r.observer)(({trafficData:e})=>{const t=o.useContext(c.b),{namespace:n,extensionsLoaded:r,watchedResources:u}=t,[p,m]=o.useState(),h=Object(d.a)(n),b=o.useMemo(()=>n&&r?u:{},[r,u,n]),f=Object(i.Ce)(m,250),g=Object(s.b)(b);return o.useEffect(()=>f(g),[f,g]),o.useEffect(()=>{t.model=null},[n]),o.useEffect(()=>{a.a(p)||Object(l.a)(t,p,e,h).then(e=>{t.loadError=e.loadError,e.loaded&&(t.loaded=!0,t.model=e.model)}).catch(()=>{})},[p,e,t,h]),null})},5716:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(5717);const r=(e,t,n,r)=>{const{extensionsLoaded:a,watchedResources:s}=e;if(!a||!t)return Promise.resolve({loaded:!1,loadError:"",model:null});const i=Object.keys(t).find(e=>(e=>t[e].loadError&&!s[e].optional?t[e].loadError:"")(e));if(i)return Promise.resolve({loaded:!1,loadError:t[i].loadError,model:null});if(!Object.keys(t).every(e=>(e=>t[e].loaded||t[e].loadError&&s[e].optional)(e)))return Promise.resolve({loaded:!1,loadError:"",model:null});const c=e.getWorkloadResources(t),l=e.dataModelDepicters;return e.getExtensionModels(t).then(a=>{const s=Object(o.a)(a,e.namespace,t,c,l,n,r);return e.reconcileModel(s,t),Promise.resolve({loaded:!0,loadError:"",model:s})})}},5717:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var o=n(1401),r=n(15),a=n(2221),s=n(5589),i=n(5647);const c=(e,t)=>{const n=e.nodes.filter(({data:e})=>e.nodeType===a.y);return e.edges.reduce((e,{data:o})=>{const{data:r}=n.find(e=>e.data.id===o.source),{data:s}=n.find(e=>e.data.id===o.target),i=t.find(e=>e.metadata.name===r[r.nodeType]),c=t.find(e=>e.metadata.name===s[s.nodeType]);return i&&c?[...e,{id:`${i.metadata.uid}_${c.metadata.uid}`,type:a.x,source:i.metadata.uid,target:c.metadata.uid,data:o.traffic}]:e},[])},l=(e,t,n,l,d,u,p)=>{const m=(e=>{const t={nodes:[],edges:[]};return s.a.forEach(n=>{var s,c;if(null===(c=null===(s=null==e?void 0:e[n])||void 0===s?void 0:s.data)||void 0===c?void 0:c.length){const s={nodes:[],edges:[]};e[n].data.forEach(t=>{const c=Object(r.yc)(n,t,e);if(c){const n=Object(i.c)(t,c,a.y,Object(o.d)("icon-openshift"),void 0,e);s.nodes.push(Object(i.h)(t,a.y,n,i.a)),Object(i.j)(Object(i.g)(t),s.nodes)}}),Object(i.b)(s,t)}}),t})(Object.assign(Object.assign({},n),{monitoringAlerts:p}));return Object(i.b)(m,e,d),(e=>{e.nodes.forEach(t=>{var n,o;t.type===a.u&&(t.children=t.children.filter(t=>e.nodes.find(e=>e.id===t)),t.data.groupResources=null!==(o=null===(n=t.children)||void 0===n?void 0:n.map(t=>e.nodes.find(e=>t===e.id)))&&void 0!==o?o:[])}),e.nodes=e.nodes.filter(e=>e.type!==a.u||e.children.length>0)})(e),((e,t)=>{t.forEach(n=>{e.edges.push(...Object(i.f)(n,t))})})(e,l),((e,t,n)=>{n&&e.edges.push(...c(n,t))})(e,l,u),e}},5718:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(0),r=n(5719),a=n(58),s=n(15);const i=e=>{const[t,n,i]=Object(r.a)({namespace:e}),c=o.useMemo(()=>{let e;return i||n||(e=Object(a.j)(null==t?void 0:t.data).alerts,e.forEach(e=>{delete e.activeAt,e.rule&&(delete e.rule.evaluationTime,delete e.rule.lastEvaluation,e.rule.alerts&&e.rule.alerts.forEach(e=>{delete e.activeAt}))})),{data:e,loaded:!i,loadError:n}},[n,i,t]);return Object(s.De)(c)}},5719:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(763),r=n(436);const a=({delay:e,namespace:t})=>{const n=Object(r.b)({endpoint:r.a.RULES,namespace:t});return Object(o.useURLPoll)(n,e,t)}},5720:function(e,t,n){"use strict";var o=n(5657);n.d(t,"a",(function(){return o.c}))},6051:function(e,t,n){"use strict";var o=n(0),r=n(219),a=n(297),s=n(319),i=n(157),c=n(281),l=n(87),d=n(55),u=n(22),p=n(160),m=n(7),h=n(15),b=n(2221),f=n(5625),g=n(5704);t.a=({namespace:e,noProjectsAvailable:t,subPath:n})=>{const{t:y}=Object(m.useTranslation)(),[v,E]=o.useState(!0),O=o.useRef([]),j=!t,[x,{touched:M,error:w}]=Object(d.e)(n?n+".application.selectedKey":"application.selectedKey"),[k]=Object(d.e)(n?n+".application.name":"application.name"),{setFieldValue:R,setFieldTouched:D}=Object(d.f)(),[K,P]=o.useState(!1),S=o.useRef(),T=Object(h.Kc)("application-name","dropdown"),L=!(M&&w),C=L?"":w;Object(h.Ge)(x.value);const z=[{actionTitle:y("topology~Create application"),actionKey:b.b},{actionTitle:y("topology~No application group"),actionKey:b.z}],A=y("topology~Application"),F=y(K?"topology~Warning: the application grouping already exists.":"topology~A unique name given to the application grouping to label your resources.");return o.useEffect(()=>{var e;x.value===b.b&&(null===(e=S.current)||void 0===e||e.focus())},[x.value]),o.createElement(o.Fragment,null,j&&v&&o.createElement(r.a,{fieldId:T,label:A},o.createElement(g.a,{id:T,ariaLabel:A,dropDownClassName:"dropdown--full-width",menuClassName:"dropdown-menu--text-wrap",namespace:e,actionItems:z,autoSelect:!0,selectedKey:x.value,onChange:(e,t)=>{R(x.name,e),D(x.name,!0),R(k.name,Object(f.b)(t,e)),D(k.name,!0),P(!1)},onLoad:e=>{var t;const n=u.a(e);E(!n),O.current=p.a(e),n&&(R(x.name,""),R(k.name,null!==(t=x.value!==b.z&&k.value)&&void 0!==t?t:""))}}),o.createElement(a.a,null,o.createElement(s.a,null,L?o.createElement(i.a,null,y("topology~Select an Application to group this component.")):o.createElement(i.a,{variant:"error",icon:o.createElement(h.Mb,null)},C)))),(!v||x.value===b.b)&&o.createElement(h.ab,{type:c.b.text,required:x.value===b.b,name:k.name,ref:S,label:y("topology~Application name"),"data-test-id":"application-form-app-input",helpText:F,validated:K?l.d.warning:l.d.default,onChange:e=>{P(O.current.includes(e.target.value.trim()))},onBlur:e=>{const t=e.target.value.trim();R(k.name,t)}}))}},6125:function(e,t,n){"use strict";n.r(t),n.d(t,"editApplicationModal",(function(){return b}));var o=n(0),r=n(242),a=n(55),s=n(16),i=n(7),c=n(118),l=n(5),d=n(2221),u=n(5625),p=n(6051);const m=({resource:e,handleSubmit:t,isSubmitting:n,cancel:a,values:l,initialApplication:d,status:u})=>{const{t:m}=Object(i.useTranslation)(),h=s.a(l,"application.selectedKey")!==d;return o.createElement("form",{onSubmit:t,className:"modal-content"},o.createElement(c.d,null,m("topology~Edit application grouping")),o.createElement(c.a,null,o.createElement(r.a,{headingLevel:"h2",size:"md",className:"co-m-form-row"},o.createElement(i.Trans,{ns:"topology"},"Select an Application group to add the component"," ",o.createElement("strong",null,{resourceName:e.metadata.name})," to")),o.createElement("div",{className:"pf-v5-c-form"},o.createElement(p.a,{namespace:e.metadata.namespace}))),o.createElement(c.c,{submitText:m("topology~Save"),submitDisabled:!h||n,cancel:a,inProgress:n,errorMessage:u&&u.submitError}))};class h extends l.bb{constructor(){super(...arguments),this.handleSubmit=(e,t)=>{const{resourceKind:n,resource:o}=this.props,r=e.application.selectedKey===d.z?void 0:e.application.name;return this.handlePromise(Object(u.c)(n,o,r)).then(()=>{this.props.close()}).catch(e=>{t.setStatus({submitError:e})})}}render(){const{resource:e}=this.props,t=s.a(e,["metadata","labels","app.kubernetes.io/part-of"]),n={application:{name:t,selectedKey:t||d.z}};return o.createElement(a.b,{initialValues:n,onSubmit:this.handleSubmit},e=>o.createElement(m,Object.assign({},e,this.props,{initialApplication:t})))}}const b=Object(c.f)(e=>o.createElement(h,Object.assign({},e)))}}]);
//# sourceMappingURL=topology-modals-chunk-482779c7d8e3135a324e.min.js.map